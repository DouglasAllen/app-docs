<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_03) on Sat Jun 23 11:20:42 UTC 2012 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>DFAOptimizer (ANTLR Master build control POM 3.2 API)</title>
<meta name="date" content="2012-06-23">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="DFAOptimizer (ANTLR Master build control POM 3.2 API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/DFAOptimizer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/antlr/analysis/DFA.html" title="class in org.antlr.analysis"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/antlr/analysis/DFAState.html" title="class in org.antlr.analysis"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/antlr/analysis/DFAOptimizer.html" target="_top">Frames</a></li>
<li><a href="DFAOptimizer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.antlr.analysis</div>
<h2 title="Class DFAOptimizer" class="title">Class DFAOptimizer</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.antlr.analysis.DFAOptimizer</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">DFAOptimizer</span>
extends java.lang.Object</pre>
<div class="block">A module to perform optimizations on DFAs.

  I could more easily (and more quickly) do some optimizations (such as
  PRUNE_EBNF_EXIT_BRANCHES) during DFA construction, but then it
  messes up the determinism checking.  For example, it looks like
  loop exit branches are unreachable if you prune exit branches
  during DFA construction and before determinism checks.

  In general, ANTLR's NFA->DFA->codegen pipeline seems very robust
  to me which I attribute to a uniform and consistent set of data
  structures.  Regardless of what I want to "say"/implement, I do so
  within the confines of, for example, a DFA.  The code generator
  can then just generate code--it doesn't have to do much thinking.
  Putting optimizations in the code gen code really starts to make
  it a spagetti factory (uh oh, now I'm hungry!).  The pipeline is
  very testable; each stage has well defined input/output pairs.

  ### Optimization: PRUNE_EBNF_EXIT_BRANCHES

  There is no need to test EBNF block exit branches.  Not only is it
  an unneeded computation, but counter-intuitively, you actually get
  better errors. You can report an error at the missing or extra
  token rather than as soon as you've figured out you will fail.

  Imagine optional block "( DOT CLASS )? SEMI".  ANTLR generates:

  int alt=0;
  if ( input.LA(1)==DOT ) {
      alt=1;
  }
  else if ( input.LA(1)==SEMI ) {
      alt=2;
  }

  Clearly, since Parser.match() will ultimately find the error, we
  do not want to report an error nor do we want to bother testing
  lookahead against what follows the (...)?  We want to generate
  simply "should I enter the subrule?":

  int alt=2;
  if ( input.LA(1)==DOT ) {
      alt=1;
  }

  NOTE 1. Greedy loops cannot be optimized in this way.  For example,
  "(greedy=false:'x'|.)* '\n'".  You specifically need the exit branch
  to tell you when to terminate the loop as the same input actually
  predicts one of the alts (i.e., staying in the loop).

  NOTE 2.  I do not optimize cyclic DFAs at the moment as it doesn't
  seem to work. ;)  I'll have to investigate later to see what work I
  can do on cyclic DFAs to make them have fewer edges.  Might have
  something to do with the EOT token.

  ### PRUNE_SUPERFLUOUS_EOT_EDGES

  When a token is a subset of another such as the following rules, ANTLR
  quietly assumes the first token to resolve the ambiguity.

  EQ                    : '=' ;
  ASSIGNOP      : '=' | '+=' ;

  It can yield states that have only a single edge on EOT to an accept
  state.  This is a waste and messes up my code generation. ;)  If
  Tokens rule DFA goes

                s0 -'='-> s3 -EOT-> s5 (accept)

  then s5 should be pruned and s3 should be made an accept.  Do NOT do this
  for keyword versus ID as the state with EOT edge emanating from it will
  also have another edge.

  ### Optimization: COLLAPSE_ALL_INCIDENT_EDGES

  Done during DFA construction.  See method addTransition() in
  NFAToDFAConverter.

  ### Optimization: MERGE_STOP_STATES

  Done during DFA construction.  See addDFAState() in NFAToDFAConverter.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#COLLAPSE_ALL_PARALLEL_EDGES">COLLAPSE_ALL_PARALLEL_EDGES</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../org/antlr/tool/Grammar.html" title="class in org.antlr.tool">Grammar</a></code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#grammar">grammar</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#MERGE_STOP_STATES">MERGE_STOP_STATES</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#PRUNE_EBNF_EXIT_BRANCHES">PRUNE_EBNF_EXIT_BRANCHES</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#PRUNE_TOKENS_RULE_SUPERFLUOUS_EOT_EDGES">PRUNE_TOKENS_RULE_SUPERFLUOUS_EOT_EDGES</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.util.Set</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#visited">visited</a></strong></code>
<div class="block">Used by DFA state machine generator to avoid infinite recursion
  resulting from cycles int the DFA.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#DFAOptimizer(org.antlr.tool.Grammar)">DFAOptimizer</a></strong>(<a href="../../../org/antlr/tool/Grammar.html" title="class in org.antlr.tool">Grammar</a>&nbsp;grammar)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#optimize()">optimize</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#optimize(org.antlr.analysis.DFA)">optimize</a></strong>(<a href="../../../org/antlr/analysis/DFA.html" title="class in org.antlr.analysis">DFA</a>&nbsp;dfa)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#optimizeEOTBranches(org.antlr.analysis.DFAState)">optimizeEOTBranches</a></strong>(<a href="../../../org/antlr/analysis/DFAState.html" title="class in org.antlr.analysis">DFAState</a>&nbsp;d)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../org/antlr/analysis/DFAOptimizer.html#optimizeExitBranches(org.antlr.analysis.DFAState)">optimizeExitBranches</a></strong>(<a href="../../../org/antlr/analysis/DFAState.html" title="class in org.antlr.analysis">DFAState</a>&nbsp;d)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="PRUNE_EBNF_EXIT_BRANCHES">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PRUNE_EBNF_EXIT_BRANCHES</h4>
<pre>public static&nbsp;boolean PRUNE_EBNF_EXIT_BRANCHES</pre>
</li>
</ul>
<a name="PRUNE_TOKENS_RULE_SUPERFLUOUS_EOT_EDGES">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>PRUNE_TOKENS_RULE_SUPERFLUOUS_EOT_EDGES</h4>
<pre>public static&nbsp;boolean PRUNE_TOKENS_RULE_SUPERFLUOUS_EOT_EDGES</pre>
</li>
</ul>
<a name="COLLAPSE_ALL_PARALLEL_EDGES">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>COLLAPSE_ALL_PARALLEL_EDGES</h4>
<pre>public static&nbsp;boolean COLLAPSE_ALL_PARALLEL_EDGES</pre>
</li>
</ul>
<a name="MERGE_STOP_STATES">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MERGE_STOP_STATES</h4>
<pre>public static&nbsp;boolean MERGE_STOP_STATES</pre>
</li>
</ul>
<a name="visited">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>visited</h4>
<pre>protected&nbsp;java.util.Set visited</pre>
<div class="block">Used by DFA state machine generator to avoid infinite recursion
  resulting from cycles int the DFA.  This is a set of int state #s.
  This is a side-effect of calling optimize; can't clear after use
  because code gen needs it.</div>
</li>
</ul>
<a name="grammar">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>grammar</h4>
<pre>protected&nbsp;<a href="../../../org/antlr/tool/Grammar.html" title="class in org.antlr.tool">Grammar</a> grammar</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="DFAOptimizer(org.antlr.tool.Grammar)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DFAOptimizer</h4>
<pre>public&nbsp;DFAOptimizer(<a href="../../../org/antlr/tool/Grammar.html" title="class in org.antlr.tool">Grammar</a>&nbsp;grammar)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="optimize()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>optimize</h4>
<pre>public&nbsp;void&nbsp;optimize()</pre>
</li>
</ul>
<a name="optimize(org.antlr.analysis.DFA)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>optimize</h4>
<pre>protected&nbsp;void&nbsp;optimize(<a href="../../../org/antlr/analysis/DFA.html" title="class in org.antlr.analysis">DFA</a>&nbsp;dfa)</pre>
</li>
</ul>
<a name="optimizeExitBranches(org.antlr.analysis.DFAState)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>optimizeExitBranches</h4>
<pre>protected&nbsp;void&nbsp;optimizeExitBranches(<a href="../../../org/antlr/analysis/DFAState.html" title="class in org.antlr.analysis">DFAState</a>&nbsp;d)</pre>
</li>
</ul>
<a name="optimizeEOTBranches(org.antlr.analysis.DFAState)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>optimizeEOTBranches</h4>
<pre>protected&nbsp;void&nbsp;optimizeEOTBranches(<a href="../../../org/antlr/analysis/DFAState.html" title="class in org.antlr.analysis">DFAState</a>&nbsp;d)</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/DFAOptimizer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/antlr/analysis/DFA.html" title="class in org.antlr.analysis"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/antlr/analysis/DFAState.html" title="class in org.antlr.analysis"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/antlr/analysis/DFAOptimizer.html" target="_top">Frames</a></li>
<li><a href="DFAOptimizer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2012. All Rights Reserved.</small></p>
</body>
</html>
