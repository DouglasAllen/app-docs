<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Storage Subpools</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.SmallBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 8.7em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.SmallBulleted {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 8.7em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-11-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-11-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>13.11.4 Storage Subpools</H1>
<div class="paranum">1/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
This subclause defines a package to support the partitioning of a storage 
pool into subpools. A subpool may be specified as the default to be used 
for allocation from the associated storage pool, or a particular subpool 
may be specified as part of an <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN> 
(see <A HREF="AA-4-8.html">4.8</A>).&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">2/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
The following language-defined library package exists:</div>
<div class="paranum">3/3</div>
<div class="Examples"><A NAME="I5692"></A><B>package</B>&nbsp;System.Storage_Pools.Subpools&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;<B>pragma</B>&nbsp;Preelaborate&nbsp;(Subpools);</div>
<div class="paranum">4/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I5693"></A>Root_Storage_Pool_With_Subpools&nbsp;<B>is</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>abstract&nbsp;new</B>&nbsp;Root_Storage_Pool&nbsp;<B>with&nbsp;private</B>;</div>
<div class="paranum">5/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I5694"></A>Root_Subpool&nbsp;<B>is&nbsp;abstract&nbsp;tagged&nbsp;limited&nbsp;private</B>;</div>
<div class="paranum">6/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I5695"></A>Subpool_Handle&nbsp;<B>is&nbsp;access&nbsp;all</B>&nbsp;Root_Subpool'Class;<BR>
&nbsp;&nbsp;&nbsp;<B>for</B>&nbsp;Subpool_Handle'Storage_Size&nbsp;<B>use</B>&nbsp;0;</div>
<div class="paranum">7/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I5696"></A>Create_Subpool&nbsp;(Pool&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Root_Storage_Pool_With_Subpools)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return&nbsp;not&nbsp;null</B>&nbsp;Subpool_Handle&nbsp;<B>is&nbsp;abstract</B>;</div>
<div class="paranum">8/3</div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0252-1.TXT">AI05-0252-1</A></I>} 
&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="roman"><I>The&nbsp;following&nbsp;operations&nbsp;are&nbsp;intended&nbsp;for&nbsp;pool&nbsp;implementers:</I></SPAN></div>
<div class="paranum">9/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I5697"></A>Pool_of_Subpool&nbsp;(Subpool&nbsp;:&nbsp;<B>not&nbsp;null</B>&nbsp;Subpool_Handle)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return&nbsp;access</B>&nbsp;Root_Storage_Pool_With_Subpools'Class;</div>
<div class="paranum">10/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I5698"></A>Set_Pool_of_Subpool&nbsp;(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subpool&nbsp;:&nbsp;<B>in&nbsp;not&nbsp;null</B>&nbsp;Subpool_Handle;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Root_Storage_Pool_With_Subpools'Class);</div>
<div class="paranum">11/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I5699"></A>Allocate_From_Subpool&nbsp;(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pool&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Root_Storage_Pool_With_Subpools;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Storage_Address&nbsp;:&nbsp;<B>out</B>&nbsp;Address;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size_In_Storage_Elements&nbsp;:&nbsp;<B>in</B>&nbsp;Storage_Elements.Storage_Count;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alignment&nbsp;:&nbsp;<B>in</B>&nbsp;Storage_Elements.Storage_Count;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subpool&nbsp;:&nbsp;<B>in&nbsp;not&nbsp;null</B>&nbsp;Subpool_Handle)&nbsp;<B>is&nbsp;abstract</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pre'Class&nbsp;=&gt;&nbsp;Pool_of_Subpool(Subpool)&nbsp;=&nbsp;Pool'Access;</div>
<div class="paranum">12/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I5700"></A>Deallocate_Subpool&nbsp;(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pool&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Root_Storage_Pool_With_Subpools;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Subpool&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Subpool_Handle)&nbsp;<B>is&nbsp;abstract</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>with</B>&nbsp;Pre'Class&nbsp;=&gt;&nbsp;Pool_of_Subpool(Subpool)&nbsp;=&nbsp;Pool'Access;</div>
<div class="paranum">13/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I5701"></A>Default_Subpool_for_Pool&nbsp;(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pool&nbsp;:&nbsp;Root_Storage_Pool_With_Subpools)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return&nbsp;not&nbsp;null</B>&nbsp;Subpool_Handle;</div>
<div class="paranum">14/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>overriding</B><BR>
&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I5702"></A>Allocate&nbsp;(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pool&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Root_Storage_Pool_With_Subpools;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Storage_Address&nbsp;:&nbsp;<B>out</B>&nbsp;Address;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size_In_Storage_Elements&nbsp;:&nbsp;<B>in</B>&nbsp;Storage_Elements.Storage_Count;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alignment&nbsp;:&nbsp;<B>in</B>&nbsp;Storage_Elements.Storage_Count);</div>
<div class="paranum">15/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>overriding</B><BR>
&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I5703"></A>Deallocate&nbsp;(<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pool&nbsp;:&nbsp;<B>in&nbsp;out</B>&nbsp;Root_Storage_Pool_With_Subpools;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Storage_Address&nbsp;:&nbsp;<B>in</B>&nbsp;Address;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size_In_Storage_Elements&nbsp;:&nbsp;<B>in</B>&nbsp;Storage_Elements.Storage_Count;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Alignment&nbsp;:&nbsp;<B>in</B>&nbsp;Storage_Elements.Storage_Count)&nbsp;<B>is&nbsp;null</B>;</div>
<div class="paranum">16/3</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>overriding</B><BR>
&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I5704"></A>Storage_Size&nbsp;(Pool&nbsp;:&nbsp;Root_Storage_Pool_With_Subpools)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;Storage_Count&nbsp;<B>is</B>&nbsp;(Storage_Elements.Storage_Count'Last);</div>
<div class="paranum">17/3</div>
<div class="Examples">private<BR>
&nbsp;&nbsp;&nbsp;...&nbsp;--&nbsp;<SPAN Class="roman"><I>not&nbsp;specified&nbsp;by&nbsp;the&nbsp;language</I></SPAN><BR>
end&nbsp;System.Storage_Pools.Subpools;</div>
<div class="paranum">18/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
<A NAME="I5705"></A><A NAME="I5706"></A><A NAME="I5707"></A><A NAME="I5708"></A><A NAME="I5709"></A>A 
<I>subpool</I> is a separately reclaimable portion of a storage pool, 
identified by an object of type Subpool_Handle (a <I>subpool handle</I>). 
A subpool handle also identifies the enclosing storage pool, a <I>storage 
pool that supports subpools</I>, which is a storage pool whose type is 
descended from Root_Storage_Pool_With_Subpools. A subpool is created 
by calling Create_Subpool or a similar constructor; the constructor returns 
the subpool handle.</div>
<div class="paranum">19/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
A <I>subpool object</I> is an object of a type descended from Root_Subpool. 
[Typically, subpool objects are managed by the containing storage pool; 
only the handles need be exposed to clients of the storage pool. Subpool 
objects are designated by subpool handles, and are the run-time representation 
of a subpool.]</div>
<div class="paranum">19.a/3</div>
<div class="Annotations"><B>Proof:&nbsp;</B>We know that subpool handles designate 
subpool objects because the declaration of Subpool_Handle says so.&nbsp;</div>
<div class="paranum">20/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
Each subpool <I>belongs</I><A NAME="I5710"></A> to a single storage pool 
[(which will always be a pool that supports subpools)]. An access to 
the pool that a subpool belongs to can be obtained by calling Pool_of_Subpool 
with the subpool handle. Set_Pool_of_Subpool causes the subpool of the 
subpool handle to belong to the given pool[; this is intended to be called 
from subpool constructors like Create_Subpool.] Set_Pool_of_Subpool propagates 
Program_Error if the subpool already belongs to a pool.</div>
<div class="paranum">20.a/3</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>Pool_of_Subpool and Set_Pool_of_Subpool 
are provided by the Ada implementation and typically will not be overridden 
by the pool implementer.&nbsp;</div>
<div class="paranum">21/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
When an <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN> 
for a type whose storage pool supports subpools is evaluated, a call 
is made on Allocate_From_Subpool passing in a Subpool_Handle, in addition 
to the parameters as defined for calls on Allocate (see <A HREF="AA-13-11.html">13.11</A>). 
The subpool designated by the <I>subpool_handle_</I><SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
is used, if specified in an <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN>. 
Otherwise, Default_Subpool_for_Pool of the Pool is used to provide a 
subpool handle. All requirements on the Allocate procedure also apply 
to Allocate_from_Subpool.</div>
<div class="paranum">21.a/3</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>Deallocate_Subpool is expected 
to do whatever is needed to deallocate all of the objects contained in 
the subpool; it is called from Unchecked_Deallocate_Subpool (see <A HREF="AA-13-11-5.html">13.11.5</A>).</div>
<div class="paranum">21.b/3</div>
<div class="Annotations">Typically, the pool implementer will not override 
Allocate. In the canonical definition of the language, it will never 
be called for a pool that supports subpools (there is an Implementation 
Permission below that allows it to be called in certain rare cases). 
</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum">22/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
If a storage pool that supports subpools is specified as the Storage_Pool 
for an access type, the access type is called a <I>subpool access type</I>.<A NAME="I5711"></A><A NAME="I5712"></A> 
A subpool access type shall be a pool-specific access type.</div>
<div class="paranum">23/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0252-1.TXT">AI05-0252-1</A></I>} 
The accessibility level of a subpool access type shall not be statically 
deeper than that of the storage pool object. If the specified storage 
pool object is a storage pool that supports subpools, then the <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
that denotes the object shall not denote part of a formal parameter, 
nor shall it denote part of a dereference of a value of a non-library-level 
general access type. <A NAME="I5713"></A>In addition to the places where 
Legality Rules normally apply (see <A HREF="AA-12-3.html">12.3</A>), 
these rules also apply in the private part of an instance of a generic 
unit.&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">24/3</div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0252-1.TXT">AI05-0252-1</A></I>} 
When an access type with a specified storage pool is frozen (see <A HREF="AA-13-14.html">13.14</A>), 
if the tag of the storage pool object identifies a storage pool that 
supports subpools, the following checks are made:</div>
<div class="paranum">25/3</div>
<div class="Bulleted">the <SPAN Class="swiss"><A HREF="AA-4-1.html#S0091">name</A></SPAN> 
used to specify the storage pool object does not denote part of a formal 
parameter nor part of a dereference of a value of a non-library-level 
general access type; and<A NAME="I5714"></A><A NAME="I5715"></A></div>
<div class="paranum">26/3</div>
<div class="Bulleted">the accessibility level of the access type is not 
deeper than that of the storage pool object.<A NAME="I5716"></A><A NAME="I5717"></A> 
</div>
<div class="paranum">27/3</div>
<div class="Normal" style="margin-bottom: 0.9em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0252-1.TXT">AI05-0252-1</A></I>} 
Program_Error is raised if either of these checks fail.<A NAME="I5718"></A></div>
<div class="paranum">27.a/3</div>
<div class="Annotations"><B>Reason:&nbsp;</B>This check (and its static counterpart) 
ensures that the type of the allocated objects exists at least as long 
as the storage pool object, so that the subpools are finalized (which 
finalizes any remaining allocated objects) before the type of the objects 
ceases to exist. The access type itself (and the associated collection) 
will cease to exist before the storage pool ceases to exist.</div>
<div class="paranum">27.b/3</div>
<div class="Annotations">We also disallow the use of formal parameters 
and dereferences of non-library-level general access types when specifying 
a storage pool object if it supports subpools, because the &quot;apparent&quot; 
accessibility level is potentially deeper than that of the underlying 
object. Neither of these cases is very likely to occur in practice.&nbsp;</div>
<div class="paranum">28/3</div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
A call to Subpools.Allocate(P, Addr, Size, Align) does the following:</div>
<div class="paranum">29/3</div>
<div class="Examples">Allocate_From_Subpool<BR>
&nbsp;&nbsp;(Root_Storage_Pool_With_Subpools'Class(P),<BR>
&nbsp;&nbsp;&nbsp;Addr,&nbsp;Size,&nbsp;Align,<BR>
&nbsp;&nbsp;&nbsp;Subpool&nbsp;=&gt;&nbsp;Default_Subpool_for_Pool<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Root_Storage_Pool_With_Subpools'Class(P)));</div>
<div class="paranum">30/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
An <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN> 
that allocates in a subpool raises Program_Error if the allocated object 
has task parts.<A NAME="I5719"></A><A NAME="I5720"></A><A NAME="I5721"></A></div>
<div class="paranum">30.a/3</div>
<div class="Annotations"><B>Reason:&nbsp;</B>This is to ease implementation. 
We envision relaxing this restriction in a future version of Ada, once 
implementation experience has been gained. At this time, we are unable 
to come up with a set of rules for task termination that is both useful, 
and surely feasible to implement.&nbsp;</div>
<div class="paranum">31/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
Unless overridden, Default_Subpool_for_Pool propagates Program_Error.</div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum">32/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
When an allocator for a type whose storage pool is of type Root_Storage_Pool'Class 
is evaluated, but supports subpools, the implementation may call Allocate 
rather than Allocate_From_Subpool. [This will have the same effect, so 
long as Allocate has not been overridden.]</div>
<div class="paranum">32.a/3</div>
<div class="Annotations" style="margin-bottom: 0.4em"><B>Reason:&nbsp;</B>This 
ensures either of two implementation models are possible for an <SPAN Class="swiss"><A HREF="AA-4-8.html#S0143">allocator</A></SPAN> 
with no <SPAN Class="swiss"><A HREF="AA-4-8.html#S0144">subpool_specification</A></SPAN>. 
Note that the &quot;supports subpools&quot; property is not known at 
compile time for a pool of the class-wide type.</div>
<div class="paranum">32.b/3</div>
<div class="SmallBulleted">The implementation can dispatch to Storage_Pools.Allocate. 
If the pool supports subpools, this will call Allocate_From_Subpool with 
the default subpool so long as Allocate has not been overridden.</div>
<div class="paranum">32.c/3</div>
<div class="SmallBulleted">The implementation can declare Allocate_From_Subpool 
as a primitive of Root_Storage_Pool in the private part of Storage_Pools. 
This means that the Allocate_From_Subpool for Root_Storage_Pool_With_Subpools 
overrides that private one. The implementation can thus call the private 
one, which will call Allocate for non-subpool-supporting pools. The effect 
of this implementation does not change if Allocate is overridden for 
a pool that supports subpools.&nbsp;</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum">33/3</div>
<div class="Notes">33&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
A user-defined storage pool type that supports subpools can be implemented 
by extending the Root_Storage_Pool_With_Subpools type, and overriding 
the primitive subprograms Create_Subpool, Allocate_From_Subpool, and 
Deallocate_Subpool. Create_Subpool should call Set_Pool_Of_Subpool before 
returning the subpool handle. To make use of such a pool, a user would 
declare an object of the type extension, use it to define the Storage_Pool 
attribute of one or more access types, and then call Create_Subpool to 
obtain subpool handles associated with the pool.</div>
<div class="paranum">34/3</div>
<div class="Notes">34&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
A user-defined storage pool type that supports subpools may define additional 
subpool constructors similar to Create_Subpool (these typically will 
have additional parameters).</div>
<div class="paranum">35/3</div>
<div class="Notes">35&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
The pool implementor should override Default_Subpool_For_Pool if the 
pool is to support a default subpool for the pool. The implementor can 
override Deallocate if individual object reclamation is to be supported, 
and can override Storage_Size if there is some limit on the total size 
of the storage pool. The implementor can override Initialize and Finalize 
if there is any need for nontrivial initialization and finalization for 
the pool as a whole. For example, Finalize might reclaim blocks of storage 
that are allocated over and above the space occupied by the pool object 
itself. The pool implementor may extend the Root_Subpool type as necessary 
to carry additional information with each subpool provided by Create_Subpool.</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum">35.a/3</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0111-3.TXT">AI05-0111-3</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0252-1.TXT">AI05-0252-1</A></I>} 
<A NAME="I5722"></A>Subpools and the package System.Storage_Pools.Subpools 
are new.&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-11-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-11-5.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
