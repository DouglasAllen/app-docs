<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Type Invariants</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2NestedBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2NestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.WideHanging-Body {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-top: 0em; margin-bottom: 0.6em}
    DIV.WideHanging-Term {float: left; font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-top: 0em; margin-bottom: 0em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>7.3.2 Type Invariants</H1>
<div class="paranum">1/3</div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
For a private type or private extension, the following language-defined 
aspects may be specified with an <SPAN Class="swiss"><A HREF="AA-13-1-1.html#S0306">aspect_specification</A></SPAN> 
(see <A HREF="AA-13-1-1.html">13.1.1</A>):</div>
<div class="paranum">2/3</div>
<div class="WideHanging-Term">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
Type_Invariant</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>.<A NAME="I3889"></A> Type_Invariant 
may be specified on a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0193">private_type_declaration</A></SPAN>, 
on a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0194">private_extension_declaration</A></SPAN>, 
or on a <SPAN Class="swiss"><A HREF="AA-3-2-1.html#S0024">full_type_declaration</A></SPAN> 
that declares the completion of a private type or private extension.<A NAME="I3890"></A><A NAME="I3891"></A></div>
<div class="paranum">2.a/3</div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Type_Invariant: 
</B>A condition that must hold true for all objects of a type.</div>
<div class="paranum">3/3</div>
<div class="WideHanging-Term">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
Type_Invariant'Class</div><div class="WideHanging-Body"><br clear="left">
This aspect shall be specified by an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0117">expression</A></SPAN>, 
called an <I>invariant expression</I>. Type_Invariant'Class may be specified 
on a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0193">private_type_declaration</A></SPAN> 
or a <SPAN Class="swiss"><A HREF="AA-7-3.html#S0194">private_extension_declaration</A></SPAN>.<A NAME="I3892"></A><A NAME="I3893"></A></div>
<div class="paranum">3.a/3</div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0254-1.TXT">AI05-0254-1</A></I>} 
A class-wide type invariant cannot be hidden in the private part, as 
the creator of an extension needs to know about it in order to conform 
to it in any new or overriding operations. On the other hand, a specific 
type invariant is not inherited, so that no operation outside of the 
original package needs to conform to it; thus there is no need for it 
to be visible.&nbsp;</div>
<div class="paranum">3.b/3</div>
<div class="Annotations"><B>Aspect Description for&nbsp;</B><B>Type_Invariant'Class: 
</B>A condition that must hold true for all objects in a class of types.</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum">4/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
The expected type for an invariant expression is any boolean type.<A NAME="I3894"></A></div>
<div class="paranum">5/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
[Within an invariant expression, the identifier of the first subtype 
of the associated type denotes the current instance of the type.] Within 
an invariant expression associated with type <I>T</I>, the type of the 
current instance is <I>T</I> for the Type_Invariant aspect and <I>T</I>'Class 
for the Type_Invariant'Class aspect.</div>
<div class="paranum">5.a/3</div>
<div class="Annotations"><B>Proof:&nbsp;</B>The first sentence is given formally 
in <A HREF="AA-13-1-1.html">13.1.1</A>.&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum">6/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
[The Type_Invariant'Class aspect shall not be specified for an untagged 
type.] The Type_Invariant aspect shall not be specified for an abstract 
type.</div>
<div class="paranum">6.a/3</div>
<div class="Annotations"><B>Proof:&nbsp;</B>The first sentence is given formally 
in <A HREF="AA-13-1-1.html">13.1.1</A>.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">7/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
[If the Type_Invariant aspect is specified for a type <I>T</I>, then 
the invariant expression applies to <I>T</I>.]</div>
<div class="paranum">8/3</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
[If the Type_Invariant'Class aspect is specified for a tagged type <I>T</I>, 
then the invariant expression applies to all descendants of <I>T</I>.]</div>
<div class="paranum">8.a/3</div>
<div class="Annotations"><B>Proof:&nbsp;</B>&quot;Applies&quot; is formally 
defined in <A HREF="AA-13-1-1.html">13.1.1</A>.&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">9/3</div>
<div class="Normal" style="margin-bottom: 0.4em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0247-1.TXT">AI05-0247-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0290-1.TXT">AI05-0290-1</A></I>} 
If one or more invariant expressions apply to a type <I>T</I>, then an 
invariant check is performed at the following places, on the specified 
object(s):<A NAME="I3895"></A><A NAME="I3896"></A></div>
<div class="paranum">10/3</div>
<div class="Bulleted">After successful default initialization of an object 
of type <I>T</I>, the check is performed on the new object;</div>
<div class="paranum">11/3</div>
<div class="Bulleted">After successful conversion to type <I>T</I>, the 
check is performed on the result of the conversion;</div>
<div class="paranum">12/3</div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
For a view conversion, outside the immediate scope of <I>T</I>, that 
converts from a descendant of <I>T</I> (including <I>T</I> itself) to 
an ancestor of type <I>T</I> (other than <I>T</I> itself), a check is 
performed on the part of the object that is of type <I>T</I>:</div>
<div class="paranum">13/3</div>
<div class="Indented2NestedBulleted">after assigning to the view conversion; 
and</div>
<div class="paranum">14/3</div>
<div class="Indented2NestedBulleted">after successful return from a call 
that passes the view conversion as an <B>in out</B> or <B>out</B> parameter. 
</div>
<div class="paranum">14.a/3</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>For a single view conversion 
that converts between distantly related types, this rule could be triggered 
for multiple types and thus multiple invariant checks may be needed. 
</div>
<div class="paranum">14.b/3</div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>For calls to inherited 
subprograms (including dispatching calls), the implied view conversions 
mean that a wrapper is probably needed. (See the Note at the bottom of 
this clause for more on the model of checks for inherited subprograms.)</div>
<div class="paranum">14.c/3</div>
<div class="Annotations">For view conversions involving class-wide types, 
the exact checks needed may not be known at compile-time. One way to 
deal with this is to have an implicit dispatching operation that is given 
the object to check and the tag of the target of the conversion, and 
which first checks if the passed tag is not for itself, and if not, checks 
the its invariant on the object and then calls the operation of its parent 
type. If the tag is for itself, the operation is complete.&nbsp;</div>
<div class="paranum">15/3</div>
<div class="Bulleted">After a successful call on the Read or Input stream 
attribute of the type <I>T</I>, the check is performed on the object 
initialized by the stream attribute;</div>
<div class="paranum">16/3</div>
<div class="Bulleted" style="margin-bottom: 0.3em">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
An invariant is checked upon successful return from a call on any subprogram 
or entry that:&nbsp;</div>
<div class="paranum">17/3</div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
is declared within the immediate scope of type <I>T</I> (or by an instance 
of a generic unit, and the generic is declared within the immediate scope 
of type <I>T</I>), and</div>
<div class="paranum">18/3</div>
<div class="Indented2Bulleted">is visible outside the immediate scope 
of type <I>T</I> or overrides an operation that is visible outside the 
immediate scope of <I>T</I>, and</div>
<div class="paranum">19/3</div>
<div class="Indented2Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0289-1.TXT">AI05-0289-1</A></I>} 
has a result with a part of type <I>T</I>, or one or more parameters 
with a part of type <I>T</I>, or an access to variable parameter whose 
designated type has a part of type <I>T</I>.&nbsp;</div>
<div class="paranum">20/3</div>
<div class="Bulleted-NoPrefix">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
The check is performed on each such part of type <I>T</I>.&nbsp;</div>
<div class="paranum">21/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0290-1.TXT">AI05-0290-1</A></I>} 
If performing checks is required by the Invariant or Invariant'Class 
assertion policies (see <A HREF="AA-11-4-2.html">11.4.2</A>) in effect 
at the point of corresponding aspect specification applicable to a given 
type, then the respective invariant expression is considered <I>enabled</I>.<A NAME="I3897"></A></div>
<div class="paranum">21.a/3</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>If a class-wide invariant 
expression is enabled for a type, it remains enabled when inherited by 
descendants of that type, even if the policy in effect is Ignore for 
the inheriting type.&nbsp;</div>
<div class="paranum">22/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0289-1.TXT">AI05-0289-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0290-1.TXT">AI05-0290-1</A></I>} 
The invariant check consists of the evaluation of each enabled invariant 
expression that applies to <I>T</I>, on each of the objects specified 
above. If any of these evaluate to False, Assertions.Assertion_Error 
is raised at the point of the object initialization, conversion, or call.<A NAME="I3898"></A> 
If a given call requires more than one evaluation of an invariant expression, 
either for multiple objects of a single type or for multiple types with 
invariants, the evaluations are performed in an arbitrary order, and 
if one of them evaluates to False, it is not specified whether the others 
are evaluated. Any invariant check is performed prior to copying back 
any by-copy <B>in out</B> or <B>out</B> parameters. Invariant checks, 
any postcondition check, and any constraint or predicate checks associated 
with <B>in out</B> or <B>out</B> parameters are performed in an arbitrary 
order.</div>
<div class="paranum">23/3</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0247-1.TXT">AI05-0247-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
The invariant checks performed on a call are determined by the subprogram 
or entry actually invoked, whether directly, as part of a dispatching 
call, or as part of a call through an access-to-subprogram value.</div>
<div class="paranum">23.a/3</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Invariant checks on subprogram 
return are not performed on objects that are accessible only through 
access values. It is also possible to call through an access-to-subprogram 
value and reach a subprogram body that has visibility on the full declaration 
of a type, from outside the immediate scope of the type. No invariant 
checks will be performed if the designated subprogram is not itself externally 
visible. These cases represent &quot;holes&quot; in the protection provided 
by invariant checks; but note that these holes cannot be caused by clients 
of the type <I>T</I> with the invariant without help for the designer 
of the package containing <I>T</I>.&nbsp;</div>
<div class="paranum">23.b/3</div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>The implementation 
might want to produce a warning if a private extension has an ancestor 
type that is a visible extension, and an invariant expression depends 
on the value of one of the components from a visible extension part. 
</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum">24/3</div>
<div class="Notes">13&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0269-1.TXT">AI05-0269-1</A></I>} 
For a call of a primitive subprogram of type <I>NT</I> that is inherited 
from type <I>T</I>, the specified checks of the specific invariants of 
both the types <I>NT</I> and <I>T</I> are performed. For a call of a 
primitive subprogram of type <I>NT</I> that is overridden for type <I>NT</I>, 
the specified checks of the specific invariants of only type <I>NT</I> 
are performed.</div>
<div class="paranum">24.a/3</div>
<div class="Annotations"><B>Proof:&nbsp;</B>This follows from the definition 
of a call on an inherited subprogram as view conversions of the parameters 
of the type and a call to the original subprogram (see <A HREF="AA-3-4.html">3.4</A>), 
along with the normal invariant checking rules. In particular, the call 
to the original subprogram takes care of any checks needed on type <I>T</I>, 
and the checks required on view conversions take care of any checks needed 
on type <I>NT</I>, specifically on <B>in out</B> and <B>out</B> parameters. 
We require this in order that the semantics of an explicitly defined 
wrapper that does nothing but call the original subprogram is the same 
as that of an inherited subprogram.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 2005</H4>
<div class="paranum">24.b/3</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0146-1.TXT">AI05-0146-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0247-1.TXT">AI05-0247-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0250-1.TXT">AI05-0250-1</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AI05s/AI05-0289-1.TXT">AI05-0289-1</A></I>} 
<A NAME="I3899"></A>Type_Invariant aspects are new.&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-4.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-7-4.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="vertical-align: middle; font-size:120%">Ada 2005 and 2012 Editions sponsored in part by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
