<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Extension Aggregates</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-3-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>4.3.2 Extension Aggregates</H1>
<div class="paranum">1</div>
<div class="Normal">[An <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN> 
specifies a value for a type that is a record extension by specifying 
a value or subtype for an ancestor of the type, followed by associations 
for any components not determined by the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN>.] 
</div>

<H4 Class="centered">Language Design Principles</H4>
<div class="paranum">1.a</div>
<div class="Annotations">The model underlying this syntax is that a record 
extension can also be viewed as a regular record type with an ancestor 
&quot;prefix.&quot; The <SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN> 
corresponds to exactly what would be needed if there were no ancestor/prefix 
type. The <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
determines the value of the ancestor/prefix.&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum">2</div>
<div class="Indented1"><SPAN Class="swiss">extension_aggregate</SPAN><A NAME="I2551"></A><A NAME="S0109"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;(<A NAME="I2552"></A><SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN>&nbsp;<B>with</B>&nbsp;<A NAME="I2553"></A><SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN>)</div>
<div class="paranum">3</div>
<div class="Indented1"><SPAN Class="swiss">ancestor_part</SPAN><A NAME="I2554"></A><A NAME="S0110"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><A NAME="I2555"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>&nbsp;|&nbsp;<A NAME="I2556"></A><SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum">4/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00287.TXT">AI95-00287-01</A></I>} 
<SPAN STYLE="font-size: 80%">{<I>expected type (extension_aggregate)</I> 
[partial]}</SPAN> <A NAME="I2557"></A>The expected type for an <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN> 
shall be a single type that is a record extension. <SPAN STYLE="font-size: 80%">{<I>expected 
type (extension_aggregate ancestor expression)</I> [partial]}</SPAN> 
<A NAME="I2558"></A>If the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
it is expected to be of any tagged type.&nbsp;</div>
<div class="paranum">4.a</div>
<div class="Annotations"><B>Reason:&nbsp;</B>We could have made the expected 
type <I>T'</I>Class where <I>T</I> is the ultimate ancestor of the type 
of the aggregate, or we could have made it even more specific than that. 
However, if the overload resolution rules get too complicated, the implementation 
gets more difficult and it becomes harder to produce good error messages. 
</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum">5/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00306.TXT">AI95-00306-01</A></I>} 
If the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
it shall denote a specific tagged subtype. If the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
it shall not be dynamically tagged. The type of the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN> 
shall be derived from the type of the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN>, 
through one or more record extensions (and no private extensions).&nbsp;</div>
<div class="paranum">5.a/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00306.TXT">AI95-00306-01</A></I>} 
The expression cannot be dynamically tagged to prevent implicit &quot;truncation&quot; 
of a dynamically-tagged value to the specific ancestor type. This is 
similar to the rules in <A HREF="AA-3-9-2.html">3.9.2</A>.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">6</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>needed component 
(extension_aggregate record_component_association_list)</I>}</SPAN> <A NAME="I2559"></A>For 
the <SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN>, 
the only components <I>needed</I> are those of the composite value defined 
by the aggregate that are not inherited from the type of the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN>, 
plus any inherited discriminants if the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
that denotes an unconstrained subtype.&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">7</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>evaluation (extension_aggregate)</I> 
[partial]}</SPAN> <A NAME="I2560"></A>For the evaluation of an <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN> 
is evaluated. If the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
it is also evaluated; if the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
the components of the value of the aggregate not given by the <SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN> 
are initialized by default as for an object of the ancestor type. Any 
implicit initializations or evaluations are performed in an arbitrary 
order, except that the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
for a discriminant is evaluated prior to any other evaluation or initialization 
that depends on it.</div>
<div class="paranum">8</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>Discriminant_Check</I> 
[partial]}</SPAN> <A NAME="I2561"></A><SPAN STYLE="font-size: 80%">{<I>check, 
language-defined (Discriminant_Check)</I>}</SPAN> <A NAME="I2562"></A>If 
the type of the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
has discriminants that are not inherited by the type of the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN>, 
then, unless the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
that denotes an unconstrained subtype, a check is made that each discriminant 
of the ancestor has the value specified for a corresponding discriminant, 
either in the <SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN>, 
or in the <SPAN Class="swiss"><A HREF="AA-3-4.html#S0035">derived_type_definition</A></SPAN> 
for some ancestor of the type of the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN>. 
<SPAN STYLE="font-size: 80%">{<I>Constraint_Error (raised by failure 
of run-time check)</I>}</SPAN> <A NAME="I2563"></A>Constraint_Error is 
raised if this check fails.&nbsp;</div>
<div class="paranum">8.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Corresponding and specified 
discriminants are defined in <A HREF="AA-3-7.html">3.7</A>. The rules 
requiring static compatibility between new discriminants of a derived 
type and the parent discriminant(s) they constrain ensure that at most 
one check is required per discriminant of the ancestor expression.&nbsp;</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum">9</div>
<div class="Notes">8&nbsp;&nbsp;If all components of the value of the 
<SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN> 
are determined by the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN>, 
then the <SPAN Class="swiss"><A HREF="AA-4-3-1.html#S0106">record_component_association_list</A></SPAN> 
is required to be simply <B>null record</B>.</div>
<div class="paranum">10</div>
<div class="Notes">9&nbsp;&nbsp;If the <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0110">ancestor_part</A></SPAN> 
is a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
then its type can be abstract. If its type is controlled, then as the 
last step of evaluating the aggregate, the Initialize procedure of the 
ancestor type is called, unless the Initialize procedure is abstract 
(see <A HREF="AA-7-6.html">7.6</A>).&nbsp;</div>

<H4 Class="centered">Examples</H4>
<div class="paranum">11</div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples of extension 
aggregates (for types defined in <A HREF="AA-3-9-1.html">3.9.1</A>):</I> 
</div>
<div class="paranum">12</div>
<div class="Examples">Painted_Point'(Point&nbsp;<B>with</B>&nbsp;Red)<BR>
(Point'(P)&nbsp;<B>with</B>&nbsp;Paint&nbsp;=&gt;&nbsp;Black)</div>
<div class="paranum">13</div>
<div class="Examples">(Expression&nbsp;<B>with</B>&nbsp;Left&nbsp;=&gt;&nbsp;1.2,&nbsp;Right&nbsp;=&gt;&nbsp;3.4)<BR>
Addition'(Binop&nbsp;<B>with&nbsp;null&nbsp;record</B>)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;presuming&nbsp;Binop&nbsp;is&nbsp;of&nbsp;type&nbsp;Binary_Operation</I></SPAN></div>

<H4 Class="centered">Extensions to Ada 83</H4>
<div class="paranum">13.a</div>
<div class="Annotations">{<I>extensions to Ada 83</I>} <A NAME="I2564"></A>The 
extension aggregate syntax is new.&nbsp;</div>

<H4 Class="centered">Incompatibilities With Ada 95</H4>
<div class="paranum">13.b/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00306.TXT">AI95-00306-01</A></I>} 
{<I>incompatibilities with Ada 95</I>} <A NAME="I2565"></A><B>Amendment 
Correction:</B> Eliminated implicit &ldquo;truncation&rdquo; of a dynamically 
tagged value when it is used as an ancestor <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>. 
If an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0104">aggregate</A></SPAN> 
includes such an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
it is illegal in Ada 2005. Such <SPAN Class="swiss"><A HREF="AA-4-3.html#S0104">aggregate</A></SPAN>s 
are thought to be rare; the problem can be fixed with a type conversion 
to the appropriate specific type if it occurs.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum">13.c/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00287.TXT">AI95-00287-01</A></I>} 
Limited <SPAN Class="swiss"><A HREF="AA-4-3-2.html#S0109">extension_aggregate</A></SPAN>s 
are allowed (since all kinds of aggregates can now be limited, see <A HREF="AA-4-3.html">4.3</A>). 
</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-3-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-4-3-3.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
