<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Unchecked Type Conversions</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-8.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-9-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>13.9 Unchecked Type Conversions</H1>
<div class="paranum">1</div>
<div class="Normal">[<SPAN STYLE="font-size: 80%">{<I>unchecked type 
conversion</I>}</SPAN> <A NAME="I5003"></A><SPAN STYLE="font-size: 80%">{<I>type 
conversion (unchecked)</I>}</SPAN> <A NAME="I5004"></A><SPAN STYLE="font-size: 80%">{<I>conversion 
(unchecked)</I>}</SPAN> <A NAME="I5005"></A><SPAN STYLE="font-size: 80%">{<I>type_conversion: 
See also unchecked type conversion</I>}</SPAN> <A NAME="I5006"></A><SPAN STYLE="font-size: 80%">{<I>cast: 
See unchecked type conversion</I>}</SPAN> <A NAME="I5007"></A>An unchecked 
type conversion can be achieved by a call to an instance of the generic 
function Unchecked_Conversion.]&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">2</div>
<div class="Normal" style="margin-bottom: 0.4em">The following language-defined 
generic library function exists:&nbsp;</div>
<div class="paranum">3</div>
<div class="Examples"><B>generic</B><BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;Source(&lt;&gt;)&nbsp;<B>is</B>&nbsp;<B>limited</B>&nbsp;<B>private</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;Target(&lt;&gt;)&nbsp;<B>is</B>&nbsp;<B>limited</B>&nbsp;<B>private</B>;<BR>
<A NAME="I5008"></A><B>function</B>&nbsp;Ada.Unchecked_Conversion(S&nbsp;:&nbsp;Source)&nbsp;<B>return</B>&nbsp;Target;<BR>
<B>pragma</B>&nbsp;Convention(Intrinsic,&nbsp;Ada.Unchecked_Conversion);<BR>
<B>pragma</B>&nbsp;Pure(Ada.Unchecked_Conversion);</div>
<div class="paranum">3.a</div>
<div class="Annotations"><B>Reason:&nbsp;</B>The <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Convention implies that the attribute Access is not allowed for instances 
of Unchecked_Conversion.&nbsp;</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">4</div>
<div class="Normal">The size of the formal parameter S in an instance 
of Unchecked_Conversion is that of its subtype. [This is the actual subtype 
passed to Source, except when the actual is an unconstrained composite 
subtype, in which case the subtype is constrained by the bounds or discriminants 
of the value of the actual expression passed to S.]</div>
<div class="paranum">5</div>
<div class="Normal" style="margin-bottom: 0.4em">If all of the following 
are true, the effect of an unchecked conversion is to return the value 
of an object of the target subtype whose representation is the same as 
that of the source object S:&nbsp;</div>
<div class="paranum">6</div>
<div class="Bulleted">S'Size = Target'Size.&nbsp;</div>
<div class="paranum">6.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Note that there is no requirement 
that the Sizes be known at compile time.&nbsp;</div>
<div class="paranum">7</div>
<div class="Bulleted">S'Alignment = Target'Alignment.</div>
<div class="paranum">8</div>
<div class="Bulleted">The target subtype is not an unconstrained composite 
subtype.</div>
<div class="paranum">9</div>
<div class="Bulleted"><SPAN STYLE="font-size: 80%">{<I>contiguous representation</I> 
[partial]}</SPAN> <A NAME="I5009"></A><SPAN STYLE="font-size: 80%">{<I>discontiguous 
representation</I> [partial]}</SPAN> <A NAME="I5010"></A>S and the target 
subtype both have a contiguous representation.</div>
<div class="paranum">10</div>
<div class="Bulleted">The representation of S is a representation of 
an object of the target subtype.&nbsp;</div>
<div class="paranum">11/2</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00426.TXT">AI95-00426-01</A></I>} 
Otherwise, if the result type is scalar, the result of the function is 
implementation defined, and can have an invalid representation (see <A HREF="AA-13-9-1.html">13.9.1</A>). 
If the result type is nonscalar, the effect is implementation defined; 
in particular, the result can be abnormal (see <A HREF="AA-13-9-1.html">13.9.1</A>).</div>
<div class="paranum">11.a.1/2</div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>The result of 
unchecked conversion for instances with scalar result types whose result 
is not defined by the language.</div>
<div class="paranum">11.a/2</div>
<div class="Annotations"><B>Implementation defined:&nbsp;</B>The effect of 
unchecked conversion for instances with nonscalar result types whose 
effect is not defined by the language.</div>
<div class="paranum">11.a.1/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00426.TXT">AI95-00426-01</A></I>} 
Note the difference between these sentences; the first only says that 
the bits returned are implementation defined, while the latter allows 
any effect. The difference is because scalar objects should never be 
abnormal unless their assignment was disrupted or if they are a subcomponent 
of an abnormal composite object. Neither exception applies to instances 
of Unchecked_Conversion.&nbsp;</div>
<div class="paranum">11.a.2/2</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00426.TXT">AI95-00426-01</A></I>} 
Whenever unchecked conversions are used, it is the programmer's responsibility 
to ensure that these conversions maintain the properties that are guaranteed 
by the language for objects of the target type. For nonscalar types, 
this requires the user to understand the underlying run-time model of 
 the implementation. The execution of a program that violates these properties 
by means of unchecked conversions returning a nonscalar type is erroneous. 
Properties of scalar types can be checked by using the Valid attribute 
(see <A HREF="AA-13-9-2.html">13.9.2</A>); programs can avoid violating 
properties of the type (and erroneous execution) by careful use of this 
attribute.</div>
<div class="paranum">11.b</div>
<div class="Annotations">An instance of Unchecked_Conversion can be applied 
to an object of a private type, assuming the implementation allows it. 
</div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum">12</div>
<div class="Normal">An implementation may return the result of an unchecked 
conversion by reference, if the Source type is not a by-copy type. [In 
this case, the result of the unchecked conversion represents simply a 
different (read-only) view of the operand of the conversion.]&nbsp;</div>
<div class="paranum">12.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>In other words, the result 
object of a call on an instance of Unchecked_Conversion can occupy the 
same storage as the formal parameter S.&nbsp;</div>
<div class="paranum">13</div>
<div class="Normal">An implementation may place restrictions on Unchecked_Conversion. 
</div>
<div class="paranum">13.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>For example, an instantiation 
of Unchecked_Conversion for types for which unchecked conversion doesn't 
make sense may be disallowed.&nbsp;</div>

<H4 Class="centered">Implementation Advice</H4>
<div class="paranum">14/2</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10051.TXT">AI95-00051-02</A></I>} 
Since the Size of an array object generally does not include its bounds, 
the bounds should not be part of the converted data.&nbsp;</div>
<div class="paranum">14.a.1/2</div>
<div class="Annotations"><B>Implementation Advice:&nbsp;</B>Since the Size 
of an array object generally does not include its bounds, the bounds 
should not be part of the converted data in an instance of Unchecked_Conversion.</div>
<div class="paranum">14.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>On the other hand, we have 
no advice to offer about discriminants and tag fields.&nbsp;</div>
<div class="paranum">15</div>
<div class="Normal">The implementation should not generate unnecessary 
run-time checks to ensure that the representation of S is a representation 
of the target type. It should take advantage of the permission to return 
by reference when possible. Restrictions on unchecked conversions should 
be avoided unless required by the target environment.&nbsp;</div>
<div class="paranum">15.a.1/2</div>
<div class="Annotations"><B>Implementation Advice:&nbsp;</B>There should not 
be unnecessary run-time checks on the result of an Unchecked_Conversion; 
the result should be returned by reference when possible. Restrictions 
on Unchecked_Conversions should be avoided.</div>
<div class="paranum">15.a</div>
<div class="Annotations"><B>Implementation Note:&nbsp;</B>As an example of 
an unnecessary run-time check, consider a record type with gaps between 
components. The compiler might assume that such gaps are always zero 
bits. If a value is produced that does not obey that assumption, then 
the program might misbehave. The implementation should not generate extra 
code to check for zero bits (except, perhaps, in a special error-checking 
mode).&nbsp;</div>
<div class="paranum">16</div>
<div class="Normal" style="margin-bottom: 0.4em"><SPAN STYLE="font-size: 80%">{<I>recommended 
level of support (unchecked conversion)</I> [partial]}</SPAN> <A NAME="I5011"></A>The 
recommended level of support for unchecked conversions is:&nbsp;</div>
<div class="paranum">17</div>
<div class="Bulleted">Unchecked conversions should be supported and should 
be reversible in the cases where this clause defines the result. <SPAN STYLE="font-size: 80%">{<I>contiguous 
representation</I> [partial]}</SPAN> <A NAME="I5012"></A><SPAN STYLE="font-size: 80%">{<I>discontiguous 
representation</I> [partial]}</SPAN> <A NAME="I5013"></A>To enable meaningful 
use of unchecked conversion, a contiguous representation should be used 
for elementary subtypes, for statically constrained array subtypes whose 
component subtype is one of the subtypes described in this paragraph, 
and for record subtypes without discriminants whose component subtypes 
are described in this paragraph.&nbsp;</div>
<div class="paranum">17.a/2</div>
<div class="Annotations"><B>Implementation Advice:&nbsp;</B>The recommended 
level of support for Unchecked_Conversion should be followed.</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum">17.b/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10051.TXT">AI95-00051-02</A></I>} 
The implementation advice about the size of array objects was moved to 
13.3 so that all of the advice about Size is in one place.</div>
<div class="paranum">17.c/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00426.TXT">AI95-00426-01</A></I>} 
Clarified that the result of Unchecked_Conversion for scalar types can 
be invalid, but not abnormal.&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-8.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-13-9-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
