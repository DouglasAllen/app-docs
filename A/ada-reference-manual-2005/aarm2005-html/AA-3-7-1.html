<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Discriminant Constraints</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-7.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-7-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>3.7.1 Discriminant Constraints</H1>
<div class="paranum">1</div>
<div class="Normal">A <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN> 
specifies the values of the discriminants for a given discriminated type. 
</div>

<H4 Class="centered">Language Design Principles</H4>
<div class="paranum">1.a</div>
<div class="Annotations">The rules in this clause are intentionally parallel 
to those given in Record Aggregates.&nbsp;</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum">2</div>
<div class="Indented1"><SPAN Class="swiss">discriminant_constraint</SPAN><A NAME="I2030"></A><A NAME="S0064"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><BR>
&nbsp;&nbsp;&nbsp;(<A NAME="I2031"></A><SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN>&nbsp;{,&nbsp;<A NAME="I2032"></A><SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN>})</div>
<div class="paranum">3</div>
<div class="Indented1"><SPAN Class="swiss">discriminant_association</SPAN><A NAME="I2033"></A><A NAME="S0065"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><BR>
&nbsp;&nbsp;&nbsp;[<I>discriminant_</I><A NAME="I2034"></A><SPAN Class="swiss"><A HREF="AA-4-1-3.html#S0099">selector_name</A></SPAN>&nbsp;{|&nbsp;<I>discriminant_</I><A NAME="I2035"></A><SPAN Class="swiss"><A HREF="AA-4-1-3.html#S0099">selector_name</A></SPAN>}&nbsp;=&gt;]&nbsp;<A NAME="I2036"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN></div>
<div class="paranum">4</div>
<div class="Indented1"><SPAN STYLE="font-size: 80%">{<I>named discriminant 
association</I>}</SPAN> <A NAME="I2037"></A>A <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN> 
is said to be <I>named</I> if it has one or more <I>discriminant_</I><SPAN Class="swiss"><A HREF="AA-4-1-3.html#S0099">selector_name</A></SPAN>s; 
<SPAN STYLE="font-size: 80%">{<I>positional discriminant association</I>}</SPAN> 
<A NAME="I2038"></A>it is otherwise said to be <I>positional</I>. In 
a <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN>, 
any positional associations shall precede any named associations.&nbsp;</div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum">5</div>
<div class="Normal">Each <SPAN Class="swiss"><A HREF="AA-4-1-3.html#S0099">selector_name</A></SPAN> 
of a named <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN> 
shall resolve to denote a discriminant of the subtype being constrained; 
<SPAN STYLE="font-size: 80%">{<I>associated discriminants (of a named 
discriminant_association)</I>}</SPAN> <A NAME="I2039"></A>the discriminants 
so named are the <I>associated discriminants</I> of the named association. 
<SPAN STYLE="font-size: 80%">{<I>associated discriminants (of a positional 
discriminant_association)</I>}</SPAN> <A NAME="I2040"></A>For a positional 
association, the <I>associated discriminant</I> is the one whose <SPAN Class="swiss"><A HREF="AA-3-7.html#S0062">discriminant_specification</A></SPAN> 
occurred in the corresponding position in the <SPAN Class="swiss"><A HREF="AA-3-7.html#S0061">known_discriminant_part</A></SPAN> 
that defined the discriminants of the subtype being constrained.</div>
<div class="paranum">6</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>expected type (discriminant_association 
expression)</I> [partial]}</SPAN> <A NAME="I2041"></A>The expected type 
for the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
in a <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN> 
is that of the associated discriminant(s).&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum">7/2</div>
<div class="Normal">{<I><A HREF="defect1.html#8652/0008">8652/0008</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00168.TXT">AI95-00168-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI95-00363-01</A></I>} 
A <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN> 
is only allowed in a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
whose <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN> 
denotes either an unconstrained discriminated subtype, or an unconstrained 
access subtype whose designated subtype is an unconstrained discriminated 
subtype. However, in the case of an access subtype, a <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN> 
is illegal if the designated type has a partial view that is constrained 
or, for a general access subtype, has <SPAN Class="swiss"><A HREF="AA-3-7.html#S0063">default_expression</A></SPAN>s 
for its discriminants. In addition to the places where Legality Rules 
normally apply (see <A HREF="AA-12-3.html">12.3</A>), these rules apply 
also in the private part of an instance of a generic unit. In a generic 
body, this rule is checked presuming all formal access types of the generic 
might be general access types, and all untagged discriminated formal 
types of the generic might have <SPAN Class="swiss"><A HREF="AA-3-7.html#S0063">default_expression</A></SPAN>s 
for their discriminants. <SPAN STYLE="font-size: 80%">{<I>generic contract 
issue</I> [partial]}</SPAN> <A NAME="I2042"></A></div>
<div class="paranum">7.a.1/2</div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN>{<I><A HREF="defect1.html#8652/0008">8652/0008</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00168.TXT">AI95-00168-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI95-00363-01</A></I>} 
</div>
<div class="paranum">7.a/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI95-00363-01</A></I>} 
The second rule is necessary to prevent objects from changing so that 
they no longer match their constraint. In Ada 95, we attempted to prevent 
this by banning every case where an aliased object could be unconstrained 
or be changed by an enclosing assignment. New ways to cause this problem 
were being discovered frequently, meaning that new rules had to be dreamed 
up to cover them. Meanwhile, aliased objects and components were getting 
more and more limited. In Ada 2005, we sweep away all of that cruft and 
replace it by a simple rule &ldquo;thou shalt not create an access subtype 
that can point to an item whose discriminants can be changed by assignment&rdquo;. 
</div>
<div class="paranum">8</div>
<div class="Normal">A named <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN> 
with more than one <SPAN Class="swiss"><A HREF="AA-4-1-3.html#S0099">selector_name</A></SPAN> 
is allowed only if the named discriminants are all of the same type. 
A <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN> 
shall provide exactly one value for each discriminant of the subtype 
being constrained.</div>
<div class="paranum">9</div>
<div class="Normal">The <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
associated with an access discriminant shall be of a type convertible 
to the anonymous access type. <SPAN STYLE="font-size: 80%">{<I>convertible 
(required)</I> [partial]}</SPAN> <A NAME="I2043"></A></div>
<div class="paranum">9.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>This implies both convertibility 
of designated types, and static accessibility. This implies that if an 
object of type T with an access discriminant is created by an allocator 
for an access type A, then it requires that the type of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
associated with the access discriminant have an accessibility level that 
is not statically deeper than that of A. This is to avoid dangling references.</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">10</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>compatibility (discriminant 
constraint with a subtype)</I> [partial]}</SPAN> <A NAME="I2044"></A>A 
<SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN> 
is <I>compatible</I> with an unconstrained discriminated subtype if each 
discriminant value belongs to the subtype of the corresponding discriminant. 
</div>
<div class="paranum">10.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>The &quot;dependent compatibility 
check&quot; has been eliminated in Ada 95. Any checking on subcomponents 
is performed when (and if) an object is created.</div>
<div class="paranum">10.b</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>There is no need to define 
compatibility with a constrained discriminated subtype, because one is 
not allowed to constrain it again.</div>
<div class="paranum">11</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>satisfies (a discriminant 
constraint)</I> [partial]}</SPAN> <A NAME="I2045"></A>A composite value 
<I>satisfies</I> a discriminant constraint if and only if each discriminant 
of the composite value has the value imposed by the discriminant constraint.</div>
<div class="paranum">12</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>elaboration (discriminant_constraint)</I> 
[partial]}</SPAN> <A NAME="I2046"></A>For the elaboration of a <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>s 
in the <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0065">discriminant_association</A></SPAN>s 
are evaluated in an arbitrary order and converted to the type of the 
associated discriminant (which might raise Constraint_Error &mdash; see 
<A HREF="AA-4-6.html">4.6</A>); the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of a named association is evaluated (and converted) once for each associated 
discriminant. <SPAN STYLE="font-size: 80%">{<I>implicit subtype conversion 
(discriminant values)</I> [partial]}</SPAN> <A NAME="I2047"></A>The result 
of each evaluation and conversion is the value imposed by the constraint 
for the associated discriminant.&nbsp;</div>
<div class="paranum">12.a</div>
<div class="Annotations"><B>Reason:&nbsp;</B>We convert to the type, not the 
subtype, so that the definition of compatibility of discriminant constraints 
is not vacuous.</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum">13</div>
<div class="Notes">56&nbsp;&nbsp;The rules of the language ensure that 
a discriminant of an object always has a value, either from explicit 
or implicit initialization.&nbsp;</div>
<div class="paranum">13.a</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>Although it is illegal to 
constrain a class-wide tagged subtype, it is possible to have a partially 
constrained class-wide subtype: If the subtype S is defined by T(A =&gt; 
B), then S'Class is partially constrained in the sense that objects of 
subtype S'Class have to have discriminants corresponding to A equal to 
B, but there can be other discriminants defined in extensions that are 
not constrained to any particular value.&nbsp;</div>

<H4 Class="centered">Examples</H4>
<div class="paranum">14</div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples (using 
types declared above in clause <A HREF="AA-3-7.html">3.7</A>):</I>&nbsp;</div>
<div class="paranum">15</div>
<div class="Examples">Large&nbsp;&nbsp;&nbsp;:&nbsp;Buffer(200);&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;&nbsp;constrained,&nbsp;always&nbsp;200&nbsp;characters</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;&nbsp;&nbsp;(explicit&nbsp;discriminant&nbsp;value)</I></SPAN><BR>
Message&nbsp;:&nbsp;Buffer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;&nbsp;unconstrained,&nbsp;initially&nbsp;100&nbsp;characters</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;&nbsp;&nbsp;(default&nbsp;discriminant&nbsp;value)</I></SPAN><BR>
Basis&nbsp;&nbsp;&nbsp;:&nbsp;Square(5);&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;&nbsp;constrained,&nbsp;always&nbsp;5&nbsp;by&nbsp;5</I></SPAN><BR>
Illegal&nbsp;:&nbsp;Square;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;&nbsp;illegal,&nbsp;a&nbsp;Square&nbsp;has&nbsp;to&nbsp;be&nbsp;constrained</I></SPAN></div>

<H4 Class="centered">Inconsistencies With Ada 83</H4>
<div class="paranum">15.a</div>
<div class="Annotations">{<I>inconsistencies with Ada 83</I>} <A NAME="I2048"></A>Dependent 
compatibility checks are no longer performed on subtype declaration. 
Instead they are deferred until object creation (see <A HREF="AA-3-3-1.html">3.3.1</A>). 
This is upward compatible for a program that does not raise Constraint_Error. 
</div>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<div class="paranum">15.b</div>
<div class="Annotations">Everything in RM83-3.7.2(7-12), which specifies 
the initial values for discriminants, is now redundant with 3.3.1, 6.4.1, 
8.5.1, and 12.4. Therefore, we don't repeat it here. Since the material 
is largely intuitive, but nevertheless complicated to state formally, 
it doesn't seem worth putting it in a &quot;NOTE.&quot;&nbsp;</div>

<H4 Class="centered">Incompatibilities With Ada 95</H4>
<div class="paranum">15.c/2</div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0008">8652/0008</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00168.TXT">AI95-00168-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00363.TXT">AI95-00363-01</A></I>} 
{<I>incompatibilities with Ada 95</I>} <A NAME="I2049"></A>The Corrigendum 
added a restriction on <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN>s 
for general access subtypes. Such constraints are prohibited if the designated 
type can be treated as constrained somewhere in the program. Ada 2005 
goes further and prohibits such <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN>s 
if the designated type has (or might have, in the case of a formal type) 
defaults for its discriminants. The use of general access subtypes is 
rare, and this eliminates a boatload of problems that required many restrictions 
on the use of aliased objects and components (now lifted). Similarly, 
Ada 2005 prohibits <SPAN Class="swiss"><A HREF="AA-3-7-1.html#S0064">discriminant_constraint</A></SPAN>s 
on any access type whose designated type has a partial view that is constrained. 
Such a type will not be constrained in the heap to avoid privacy problems. 
Again, the use of such subtypes is rare (they can only happen within 
the package and its child units).&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-7.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-3-7-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
