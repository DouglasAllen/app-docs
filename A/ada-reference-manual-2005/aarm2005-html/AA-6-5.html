<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>Return Statements</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Indented1 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-4-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-5-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>6.5 Return Statements</H1>
<div class="paranum">1/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
A <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
(collectively called a <I>return statement</I>) <SPAN STYLE="font-size: 80%">{<I>return 
statement</I>}</SPAN> <A NAME="I3376"></A> is used to complete the execution 
of the innermost enclosing <SPAN Class="swiss"><A HREF="AA-6-3.html#S0162">subprogram_body</A></SPAN>, 
<SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0203">entry_body</A></SPAN>, 
or <SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0201">accept_statement</A></SPAN>. 
</div>

<H4 Class="centered">Syntax</H4>
<div class="paranum">2/2</div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN Class="swiss">simple_return_statement</SPAN><A NAME="I3377"></A><A NAME="S0168"></A><A NAME="S0169"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><B>return</B>&nbsp;[<A NAME="I3378"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>];</div>
<div class="paranum">2.1/2</div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN Class="swiss">extended_return_statement</SPAN><A NAME="I3379"></A><A NAME="S0170"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;<A NAME="I3380"></A><SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">defining_identifier</A></SPAN>&nbsp;:&nbsp;[<B>aliased</B>]&nbsp;<A NAME="I3381"></A><SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN>&nbsp;[:=&nbsp;<A NAME="I3382"></A><SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>]&nbsp;[<B>do</B><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A NAME="I3383"></A><SPAN Class="swiss"><A HREF="AA-11-2.html#S0247">handled_sequence_of_statements</A></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;<B>end</B>&nbsp;<B>return</B>];</div>
<div class="paranum">2.2/2</div>
<div class="Indented1">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN Class="swiss">return_subtype_indication</SPAN><A NAME="I3384"></A><A NAME="S0171"></A><SPAN Class="swiss">&nbsp;::=&nbsp;</SPAN><A NAME="I3385"></A><SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>&nbsp;|&nbsp;<A NAME="I3386"></A><SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN></div>

<H4 Class="centered">Name Resolution Rules</H4>
<div class="paranum">3/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN STYLE="font-size: 80%">{<I>result subtype (of a function)</I>}</SPAN> 
<A NAME="I3387"></A>The <I>result subtype</I> of a function is the subtype 
denoted by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
or defined by the <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
after the reserved word <B>return</B> in the profile of the function.<SPAN STYLE="font-size: 80%">{<I>expected 
type (expression of simple_return_statement)</I> [partial]}</SPAN> <A NAME="I3388"></A>The 
expected type for the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
if any, of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
is the result type of the corresponding function. <SPAN STYLE="font-size: 80%">{<I>expected 
type (expression of extended_return_statement)</I> [partial]}</SPAN> 
<A NAME="I3389"></A>The expected type for the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
is that of the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN>. 
</div>
<div class="paranum">3.a</div>
<div class="Annotations"><B>To be honest:&nbsp;</B>The same applies to generic 
functions.&nbsp;</div>

<H4 Class="centered">Legality Rules</H4>
<div class="paranum">4/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN STYLE="font-size: 80%">{<I>apply (to a callable construct by a 
return statement)</I>}</SPAN> <A NAME="I3390"></A>A return statement 
shall be within a callable construct, and it <I>applies to</I> the innermost 
callable construct or <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
that contains it. A return statement shall not be within a body that 
is within the construct to which the return statement applies.</div>
<div class="paranum">5/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
A function body shall contain at least one return statement that applies 
to the function body, unless the function contains <SPAN Class="swiss"><A HREF="AA-13-8.html#S0294">code_statement</A></SPAN>s. 
A <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
shall include an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
if and only if it applies to a function body. An <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
shall apply to a function body.&nbsp;</div>
<div class="paranum">5.a/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
The requirement that a function body has to have at least one return 
statement is a &ldquo;helpful&rdquo; restriction. There has been some 
interest in lifting this restriction, or allowing a raise statement to 
substitute for the return statement. However, there was enough interest 
in leaving it as is that we decided not to change it.&nbsp;</div>
<div class="paranum">5.b/2</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
A return statement can apply to an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>, 
so a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
without an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
can be given in one. However, neither <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
with an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
nor an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
can be given inside an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>, 
as they must apply (directly) to a function body.&nbsp;</div>
<div class="paranum">5.1/2</div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
For an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
that applies to a function body:</div>
<div class="paranum">5.2/2</div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
If the result subtype of the function is defined by a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0028">subtype_mark</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
shall be a <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN>. 
The type of the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
shall be the result type of the function. If the result subtype of the 
function is constrained, then the subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
shall also be constrained and shall statically match this result subtype. 
<SPAN STYLE="font-size: 80%">{<I>statically matching (required)</I> [partial]}</SPAN> 
<A NAME="I3391"></A>If the result subtype of the function is unconstrained, 
then the subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
shall be a definite subtype, or there shall be an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>.</div>
<div class="paranum">5.3/2</div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
If the result subtype of the function is defined by an <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
shall be an <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN>. 
The subtype defined by the <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN> 
shall statically match the result subtype of the function. The accessibility 
level of this anonymous access subtype is that of the result subtype.</div>
<div class="paranum">5.4/2</div>
<div class="Normal" style="margin-bottom: 0.4em">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
For any return statement that applies to a function body:</div>
<div class="paranum">5.5/2</div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
If the result subtype of the function is limited, then the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of the return statement (if any) shall be an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0104">aggregate</A></SPAN>, 
a function call (or equivalent use of an operator), or a <SPAN Class="swiss"><A HREF="AA-4-7.html#S0128">qualified_expression</A></SPAN> 
or parenthesized expression whose operand is one of these.&nbsp;</div>
<div class="paranum">5.c/2</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>In other words, if limited, 
the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
must produce a &ldquo;new&rdquo; object, rather than being the name of 
a preexisting object (which would imply copying).&nbsp;</div>
<div class="paranum">5.6/2</div>
<div class="Bulleted">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
If the result subtype of the function is class-wide, the accessibility 
level of the type of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of the return statement shall not be statically deeper than that of the 
master that elaborated the function body. If the result subtype has one 
or more unconstrained access discriminants, the accessibility level of 
the anonymous access type of each access discriminant, as determined 
by the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
or the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN>, 
shall not be statically deeper than that of the master that elaborated 
the function body.</div>
<div class="paranum">5.d/2</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>We know that if the result 
type is class wide, then there must be an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of the return statement. Similarly, if the result subtype is unconstrained, 
then either the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
(if any) is constrained, or there must be an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>. 
</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">5.7/2</div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN STYLE="font-size: 80%">{<I>return object (extended_return_statement)</I> 
[partial]}</SPAN> <A NAME="I3392"></A>Within an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>, 
the <I>return object</I> is declared with the given <SPAN Class="swiss"><A HREF="AA-3-1.html#S0022">defining_identifier</A></SPAN>, 
with the nominal subtype defined by the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN>. 
</div>

<H4 Class="centered">Dynamic Semantics</H4>
<div class="paranum">5.8/2</div>
<div class="Normal">&nbsp;&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
<SPAN STYLE="font-size: 80%">{<I>execution (extended_return_statement)</I> 
[partial]}</SPAN> <A NAME="I3393"></A>For the execution of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-3-2-2.html#S0027">subtype_indication</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-3-10.html#S0084">access_definition</A></SPAN> 
is elaborated. This creates the nominal subtype of the return object. 
If there is an <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
it is evaluated and converted to the nominal subtype (which might raise 
Constraint_Error &mdash; see <A HREF="AA-4-6.html">4.6</A><SPAN STYLE="font-size: 80%">{<I>implicit 
subtype conversion (function return)</I> [partial]}</SPAN> <A NAME="I3394"></A>); 
the return object is created and the converted value is assigned to the 
return object. Otherwise, the return object is created and initialized 
by default as for a stand-alone object of its nominal subtype (see <A HREF="AA-3-3-1.html">3.3.1</A>). 
If the nominal subtype is indefinite, the return object is constrained 
by its initial value.<SPAN STYLE="font-size: 80%">{<I>creation (of a 
return object)</I> [partial]}</SPAN> <A NAME="I3395"></A></div>
<div class="paranum">5.e/2</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>If the result type is controlled 
or has a controlled part, appropriate calls on Initialize or Adjust are 
performed prior to executing the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0247">handled_sequence_of_statements</A></SPAN>, 
except when the initial expression is an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0104">aggregate</A></SPAN> 
(which requires build-in-place with no call on Adjust).</div>
<div class="paranum">5.f/2</div>
<div class="Annotations">If the return statement is left without resulting 
in a return (for example, due to an exception propagated from the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
or the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0247">handled_sequence_of_statements</A></SPAN>, 
or a goto out of the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0247">handled_sequence_of_statements</A></SPAN>), 
the return object is finalized prior to leaving the return statement. 
</div>
<div class="paranum">6/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<SPAN STYLE="font-size: 80%">{<I>execution (simple_return_statement)</I> 
[partial]}</SPAN> <A NAME="I3396"></A>For the execution of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
(if any) is first evaluated, converted to the result subtype, and then 
is assigned to the anonymous <I>return object</I>. <SPAN STYLE="font-size: 80%">{<I>return 
object (simple_return_statement)</I> [partial]}</SPAN> <A NAME="I3397"></A><SPAN STYLE="font-size: 80%">{<I>implicit 
subtype conversion (function return)</I> [partial]}</SPAN> <A NAME="I3398"></A></div>
<div class="paranum">6.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>The conversion might raise 
Constraint_Error &mdash; (see <A HREF="AA-4-6.html">4.6</A>).&nbsp;</div>
<div class="paranum">7/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
[If the return object has any parts that are tasks, the activation of 
those tasks does not occur until after the function returns (see <A HREF="AA-9-2.html">9.2</A>).] 
</div>
<div class="paranum">7.a/2</div>
<div class="Annotations"><B>Proof:&nbsp;</B>This is specified by the rules 
in <A HREF="AA-9-2.html">9.2</A>.&nbsp;</div>
<div class="paranum">7.b/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>Only the caller can know when 
task activations should take place, as it depends on the context of the 
call. If the function is being used to initialize the component of some 
larger object, then that entire object must be initialized before any 
task activations. Even after the outer object is fully initialized, task 
activations are still postponed until the <B>begin</B> at the end of 
the declarative part if the function is being used to initialize part 
of a declared object.&nbsp;</div>
<div class="paranum">8/2</div>
<div class="Normal">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00344.TXT">AI95-00344-01</A></I>} 
If the result type of a function is a specific tagged type, the tag of 
the return object is that of the result type. If the result type is class-wide, 
the tag of the return object is that of the value of the expression. 
A check is made that the accessibility level of the type identified by 
the tag of the result is not deeper than that of the master that elaborated 
the function body. If this check fails, Program_Error is raised.<SPAN STYLE="font-size: 80%">{<I>Program_Error 
(raised by failure of run-time check)</I>}</SPAN> <A NAME="I3399"></A><SPAN STYLE="font-size: 80%">{<I>Accessibility_Check</I> 
[partial]}</SPAN> <A NAME="I3400"></A><SPAN STYLE="font-size: 80%">{<I>check, 
language-defined (Accessibility_Check)</I>}</SPAN> <A NAME="I3401"></A></div>
<div class="paranum">8.a/2</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
The first sentence is true even if the tag of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
is different, which could happen if the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
were a view conversion or a dereference of an access value. Note that 
for a limited type, because of the restriction to <SPAN Class="swiss"><A HREF="AA-4-3.html#S0104">aggregate</A></SPAN>s 
and function calls (and no conversions), the tag will already match. 
</div>
<div class="paranum">8.b/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
The first rule ensures that a function whose result type is a specific 
tagged type always returns an object whose tag is that of the result 
type. This is important for dispatching on controlling result, and allows 
the caller to allocate the appropriate amount of space to hold the value 
being returned (assuming there are no discriminants).</div>
<div class="paranum">8.c/2</div>
<div class="Annotations">The check prevents the returned object from 
outliving its type. Note that this check cannot fail for a specific tagged 
type, as the tag represents the function's type, which necessarily must 
be declared outside of the function.&nbsp;</div>
<div class="Normal"><SPAN STYLE="font-size: 80%"><I>Paragraphs 9 through 
20 were deleted.</I></SPAN>&nbsp;</div>
<div class="paranum">21/2</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00402.TXT">AI95-00402-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
If the result subtype of a function has one or more unconstrained access 
discriminants, a check is made that the accessibility level of the anonymous 
access type of each access discriminant, as determined by the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
or the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
of the function, is not deeper than that of the master that elaborated 
the function body. If this check fails, Program_Error is raised. <SPAN STYLE="font-size: 80%">{<I>Program_Error 
(raised by failure of run-time check)</I>}</SPAN> <A NAME="I3402"></A><SPAN STYLE="font-size: 80%">{<I>Accessibility_Check</I> 
[partial]}</SPAN> <A NAME="I3403"></A><SPAN STYLE="font-size: 80%">{<I>check, 
language-defined (Accessibility_Check)</I>}</SPAN> <A NAME="I3404"></A></div>
<div class="paranum">21.a/2</div>
<div class="Annotations"><SPAN STYLE="font-size: 80%"><I>This paragraph 
was deleted.</I></SPAN></div>
<div class="paranum">21.b/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>The check prevents the returned 
object (for a nonlimited type) from outliving the object designated by 
one of its discriminants. The check is made on the values of the discriminants, 
which may come from the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
(if constrained), or the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN>, 
but it is never necessary to check both.&nbsp;</div>
<div class="paranum">22/2</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
For the execution of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>, 
the <SPAN Class="swiss"><A HREF="AA-11-2.html#S0247">handled_sequence_of_statements</A></SPAN> 
is executed. Within this <SPAN Class="swiss"><A HREF="AA-11-2.html#S0247">handled_sequence_of_statements</A></SPAN>, 
the execution of a <SPAN Class="swiss"><A HREF="AA-6-5.html#S0168">simple_return_statement</A></SPAN> 
that applies to the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
causes a transfer of control that completes the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>. 
Upon completion of a return statement that applies to a callable construct, 
a transfer of control is performed which completes the execution of the 
callable construct, and returns to the caller.</div>
<div class="paranum">23/2</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
In the case of a function, the <SPAN Class="swiss"><A HREF="AA-6-4.html#S0164">function_call</A></SPAN> 
denotes a constant view of the return object.&nbsp;</div>

<H4 Class="centered">Implementation Permissions</H4>
<div class="paranum">24/2</div>
<div class="Normal">&nbsp;{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
If the result subtype of a function is unconstrained, and a call on the 
function is used to provide the initial value of an object with a constrained 
nominal subtype, Constraint_Error may be raised at the point of the call 
(after abandoning the execution of the function body) if, while elaborating 
the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
or evaluating the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of a return statement that applies to the function body, it is determined 
that the value of the result will violate the constraint of the subtype 
of this object.&nbsp;</div>
<div class="paranum">24.a/2</div>
<div class="Annotations"><B>Reason:&nbsp;</B>Without such a permission, it 
would be very difficult to implement &ldquo;build-in-place&rdquo; semantics. 
Such an exception is not handleable within the function, because in the 
return-by-copy case, the constraint check to verify that the result satisfies 
the constraints of the object being initialized happens after the function 
returns, and we want the semantics to change as little as possible when 
switching between return-by-copy and build-in-place. This implies further 
that upon detecting such a situation, the implementation may need to 
simulate a goto to a point outside any local exception handlers prior 
to raising the exception.&nbsp;</div>
<div class="paranum">24.b/2</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>This permission is allowed 
during the evaluation of the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>, 
because the <SPAN Class="swiss"><A HREF="AA-6-5.html#S0171">return_subtype_indication</A></SPAN> 
may be unconstrained and the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
then would provide the constraints.&nbsp;</div>

<H4 Class="centered">Examples</H4>
<div class="paranum">25</div>
<div class="Normal" style="margin-bottom: 0.4em"><I>Examples of return 
statements:</I>&nbsp;</div>
<div class="paranum">26/2</div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<B>return</B>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;in&nbsp;a&nbsp;procedure&nbsp;body,&nbsp;</I></SPAN><SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0203">entry_body</A></SPAN><SPAN Class="roman"><I>,</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;<SPAN Class="swiss"><A HREF="AA-9-5-2.html#S0201">accept_statement</A></SPAN><SPAN Class="roman"><I>,&nbsp;or&nbsp;</I></SPAN><SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN></div>
<div class="paranum">27</div>
<div class="Examples"><B>return</B>&nbsp;Key_Value(Last_Index);&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;in&nbsp;a&nbsp;function&nbsp;body</I></SPAN></div>
<div class="paranum">28/2</div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
<B>return</B>&nbsp;Node&nbsp;:&nbsp;Cell&nbsp;<B>do</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--<SPAN Class="roman"><I>&nbsp;in&nbsp;a&nbsp;function&nbsp;body,&nbsp;see&nbsp;<A HREF="AA-3-10-1.html">3.10.1</A>&nbsp;for&nbsp;Cell</I></SPAN><BR>
&nbsp;&nbsp;&nbsp;Node.Value&nbsp;:=&nbsp;Result;<BR>
&nbsp;&nbsp;&nbsp;Node.Succ&nbsp;:=&nbsp;Next_Node;<BR>
<B>end</B>&nbsp;<B>return</B>;</div>

<H4 Class="centered">Incompatibilities With Ada 83</H4>
<div class="paranum">28.a/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I>incompatibilities with Ada 83</I>} <A NAME="I3405"></A>In Ada 95, 
if the result type of a function has a part that is a task, then an attempt 
to return a local variable will raise Program_Error. This is illegal 
in Ada 2005, see below. In Ada 83, if a function returns a local variable 
containing a task, execution is erroneous according to AI83-00867. However, 
there are other situations where functions that return tasks (or that 
return a variant record only one of whose variants includes a task) are 
correct in Ada 83 but will raise Program_Error according to the new rules.</div>
<div class="paranum">28.b</div>
<div class="Annotations">The rule change was made because there will 
be more types (protected types, limited controlled types) in Ada 95 for 
which it will be meaningless to return a local variable, and making all 
of these erroneous is unacceptable. The current rule was felt to be the 
simplest that kept upward incompatibilities to situations involving returning 
tasks, which are quite rare.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 83</H4>
<div class="paranum">28.c</div>
<div class="Annotations">This clause has been moved here from chapter 
5, since it has mainly to do with subprograms.</div>
<div class="paranum">28.d</div>
<div class="Annotations">A function now creates an anonymous object. 
This is necessary so that controlled types will work.</div>
<div class="paranum">28.e/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
We have clarified that a return statement applies to a callable construct, 
not to a callable entity.</div>
<div class="paranum">28.f/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
There is no need to mention generics in the rules about where a return 
statement can appear and what it applies to; the phrase &ldquo;body of 
a subprogram or generic subprogram&rdquo; is syntactic, and refers exactly 
to &ldquo;<SPAN Class="swiss"><A HREF="AA-6-3.html#S0162">subprogram_body</A></SPAN>&rdquo;. 
</div>

<H4 Class="centered">Incompatibilities With Ada 95</H4>
<div class="paranum">28.g/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I>incompatibilities with Ada 95</I>} <A NAME="I3406"></A> The entire 
business about return-by-reference types has been dropped. Instead, the 
<SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of a return statement of a limited type can only be an <SPAN Class="swiss"><A HREF="AA-4-3.html#S0104">aggregate</A></SPAN> 
or <SPAN Class="swiss"><A HREF="AA-6-4.html#S0164">function_call</A></SPAN> 
(see <A HREF="AA-7-5.html">7.5</A>). This means that returning a global 
object or <SPAN Class="swiss"><A HREF="AA-4-6.html#S0127">type_conversion</A></SPAN>, 
legal in Ada 95, is now illegal. Such functions can be converted to use 
anonymous access return types by adding <B>access</B> in the function 
definition and return statement, adding .<B>all</B> in uses, and adding 
<B>aliased</B> in the object declarations. This has the advantage of 
making the reference return semantics much clearer to the casual reader.</div>
<div class="paranum">28.h/2</div>
<div class="Annotations">We changed these rules so that functions, combined 
with the new rules for limited types (<A HREF="AA-7-5.html">7.5</A>), 
can be used as build-in-place constructors for limited types. This reduces 
the differences between limited and nonlimited types, which will make 
limited types useful in more circumstances.&nbsp;</div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum">28.i/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
{<I>extensions to Ada 95</I>} <A NAME="I3407"></A>The <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN> 
is new. This provides a name for the object being returned, which reduces 
the copying needed to return complex objects (including no copying at 
all for limited objects). It also allows component-by-component construction 
of the return object.&nbsp;</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum">28.j/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
The wording was updated to support anonymous access return subtypes.</div>
<div class="paranum">28.k/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-10318.TXT">AI95-00318-02</A></I>} 
The term &ldquo;return expression&rdquo; was dropped because reviewers 
found it confusing when applied to the default <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of an <SPAN Class="swiss"><A HREF="AA-6-5.html#S0170">extended_return_statement</A></SPAN>.</div>
<div class="paranum">28.l/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00344.TXT">AI95-00344-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
Added accessibility checks to class-wide return statements. These checks 
could not fail in Ada 95 (as all of the types had to be declared at the 
same level, so the tagged type would necessarily have been at the same 
level as the type of the object).</div>
<div class="paranum">28.m/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00402.TXT">AI95-00402-01</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
Added accessibility checks to return statements for types with access 
discriminants. Since such types have to be limited in Ada 95, the <SPAN Class="swiss"><A HREF="AA-4-4.html#S0115">expression</A></SPAN> 
of a return statement would have been illegal in order for this check 
to fail.</div>
<div class="paranum">28.n/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00416.TXT">AI95-00416-01</A></I>} 
Added an Implementation Permission allowing early raising of Constraint_Error 
if the result cannot fit in the ultimate object. This gives implementations 
more flexibility to do built-in-place returns, and is essential for limited 
types (which cannot be built in a temporary).&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-4-1.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-6-5-1.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
