<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
    <TITLE>The Package Interfaces.C.Strings</TITLE>
    <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
    <META NAME="Author" CONTENT="JTC1/SC22/WG9/ARG, by Randall Brukardt, ARG Editor">
    <META NAME="GENERATOR" CONTENT="Arm_Form.Exe, Ada Reference Manual generator">
    <STYLE type="text/css">
    H4.centered {text-align: center}
    SPAN.swiss {font-family: Arial, Helvetica, sans-serif; font-size: 92%}
    SPAN.roman {font-family: "Times New Roman", Times, serif}
    DIV.paranum {float: left; font-family: Arial, Helvetica, sans-serif; font-size: 64%; width: 2.8em; margin-left: -0.4em; margin-right: -3.0em; margin-top: 0.2em}
    TT {font-family: "Courier New", monospace}
    DT {display: compact}
    DIV.Normal {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 1.2em; margin-bottom: 0.6em}
    DIV.Indented2 {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 5.2em; margin-bottom: 0.6em}
    DIV.Notes {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em; margin-bottom: 0.6em}
    DIV.Annotations {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-bottom: 0.6em}
    DIV.NotesHeader {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 3.7em}
    DIV.Examples {font-family: "Courier New", monospace; font-size: 90%; line-height: 122%; margin-left: 3.4em; margin-bottom: 0.6em}
    DIV.Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 3.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented3Bulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented3Bulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 7.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented2SmallBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented2SmallBulleted {font-family: "Times New Roman", Times, serif; font-size: 80%; line-height: 122%; margin-left: 6.2em; margin-right: 2.5em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    DIV.Indented4NestedBulleted-NoPrefix {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 9.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em}
    DIV.Indented4NestedBulleted {font-family: "Times New Roman", Times, serif; line-height: 122%; margin-left: 9.2em; margin-right: 2.0em; margin-top: 0em; margin-bottom: 0.5em; display: list-item; list-style-type: disc}
    </STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#FFFFF0" LINK="#000080" VLINK="#330033" ALINK="#0000FF">
<DIV><B><SPAN Style="font-size:200%; color: rgb(0,51,153)">Annotated</SPAN><SPAN Style="font-size:200%; color: rgb(0,0,102)">&nbsp;Ada Reference Manual</SPAN></B> &mdash; <A HREF="AA-TTL.html"><B>Legal Information</B></A></DIV>
<div style="margin-top: 0.6em; margin-bottom: 0.0em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<HR>
<H1>B.3.1 The Package Interfaces.C.Strings</H1>
<div class="paranum">1</div>
<div class="Normal">The package Interfaces.C.Strings declares types and 
subprograms allowing an Ada program to allocate, reference, update, and 
free C-style strings. In particular, the private type chars_ptr corresponds 
to a common use of &ldquo;char *&rdquo; in C programs, and an object 
of this type can be passed to a subprogram to which <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Import(C,...) has been applied, and for which &ldquo;char *&rdquo; is 
the type of the argument of the C function.&nbsp;</div>

<H4 Class="centered">Static Semantics</H4>
<div class="paranum">2</div>
<div class="Normal" style="margin-bottom: 0.4em">The library package 
Interfaces.C.Strings has the following declaration:&nbsp;</div>
<div class="paranum">3</div>
<div class="Examples"><B>package</B>&nbsp;Interfaces.C.Strings&nbsp;<B>is</B><A NAME="I6971"></A><BR>
&nbsp;&nbsp;&nbsp;<B>pragma</B>&nbsp;Preelaborate(Strings);</div>
<div class="paranum">4</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I6972"></A>char_array_access&nbsp;<B>is</B>&nbsp;<B>access</B>&nbsp;<B>all</B>&nbsp;char_array;</div>
<div class="paranum">5/2</div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00161.TXT">AI95-00161-01</A></I>} 
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I6973"></A>chars_ptr&nbsp;<B>is</B>&nbsp;<B>private</B>;<BR>
&nbsp;&nbsp;&nbsp;<B>pragma</B>&nbsp;Preelaborable_Initialization(chars_ptr);</div>
<div class="paranum">6/2</div>
<div class="Examples">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00276.TXT">AI95-00276-01</A></I>} 
&nbsp;&nbsp;&nbsp;<B>type</B>&nbsp;<A NAME="I6974"></A>chars_ptr_array&nbsp;<B>is</B>&nbsp;<B>array</B>&nbsp;(size_t&nbsp;<B>range</B>&nbsp;&lt;&gt;)&nbsp;<B>of</B>&nbsp;<B>aliased</B>&nbsp;chars_ptr;</div>
<div class="paranum">7</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<A NAME="I6975"></A>Null_Ptr&nbsp;:&nbsp;<B>constant</B>&nbsp;chars_ptr;</div>
<div class="paranum">8</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6976"></A>To_Chars_Ptr&nbsp;(Item&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array_access;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nul_Check&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;False)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;chars_ptr;</div>
<div class="paranum">9</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6977"></A>New_Char_Array&nbsp;(Chars&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array)&nbsp;<B>return</B>&nbsp;chars_ptr;</div>
<div class="paranum">10</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6978"></A>New_String&nbsp;(Str&nbsp;:&nbsp;<B>in</B>&nbsp;String)&nbsp;<B>return</B>&nbsp;chars_ptr;</div>
<div class="paranum">11</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I6979"></A>Free&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;<B>out</B>&nbsp;chars_ptr);</div>
<div class="paranum">12</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<A NAME="I6980"></A>Dereference_Error&nbsp;:&nbsp;<B>exception</B>;</div>
<div class="paranum">13</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6981"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;char_array;</div>
<div class="paranum">14</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6982"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;char_array;</div>
<div class="paranum">15</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6983"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;String;</div>
<div class="paranum">16</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6984"></A>Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;String;</div>
<div class="paranum">17</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>function</B>&nbsp;<A NAME="I6985"></A>Strlen&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;size_t;</div>
<div class="paranum">18</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I6986"></A>Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chars&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;True);</div>
<div class="paranum">19</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<B>procedure</B>&nbsp;<A NAME="I6987"></A>Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Str&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;String;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;True);</div>
<div class="paranum">20</div>
<div class="Examples">&nbsp;&nbsp;&nbsp;<A NAME="I6988"></A>Update_Error&nbsp;:&nbsp;<B>exception</B>;</div>
<div class="paranum">21</div>
<div class="Examples"><B>private</B><BR>
&nbsp;&nbsp;&nbsp;...&nbsp;--&nbsp;<SPAN Class="roman"><I>not&nbsp;specified&nbsp;by&nbsp;the&nbsp;language</I></SPAN><BR>
<B>end</B>&nbsp;Interfaces.C.Strings;</div>
<div class="paranum">21.a</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>The string manipulation types 
and subprograms appear in a child of Interfaces.C versus being there 
directly, since it is useful to have Interfaces.C specified as <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Pure.</div>
<div class="paranum">21.b</div>
<div class="Annotations">Differently named functions New_String and New_Char_Array 
are declared, since if there were a single overloaded function a call 
with a string literal as actual parameter would be ambiguous.&nbsp;</div>
<div class="paranum">22</div>
<div class="Normal">The type chars_ptr is C-compatible and corresponds 
to the use of C's &ldquo;char *&rdquo; for a pointer to the first char 
in a char array terminated by nul. When an object of type chars_ptr is 
declared, its value is by default set to Null_Ptr, unless the object 
is imported (see <A HREF="AA-B-1.html">B.1</A>).&nbsp;</div>
<div class="paranum">22.a</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>The type char_array_access 
is not necessarily C-compatible, since an object of this type may carry 
&ldquo;dope&rdquo; information. The programmer should convert from char_array_access 
to chars_ptr for objects imported from, exported to, or passed to C.</div>
<div class="paranum">23</div>
<div class="Examples"><B>function</B>&nbsp;To_Chars_Ptr&nbsp;(Item&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array_access;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nul_Check&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;False)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;chars_ptr;</div>
<div class="paranum">24/1</div>
<div class="Indented2" style="margin-bottom: 0.9em">{<I><A HREF="defect1.html#8652/0061">8652/0061</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00140.TXT">AI95-00140-01</A></I>} 
If Item is <B>null</B>, then To_Chars_Ptr returns Null_Ptr. If Item is 
not <B>null</B>, Nul_Check is True, and Item.<B>all</B> does not contain 
nul, then the function propagates Terminator_Error; otherwise To_Chars_Ptr 
performs a pointer conversion with no allocation of memory.</div>
<div class="paranum">25</div>
<div class="Examples"><B>function</B>&nbsp;New_Char_Array&nbsp;(Chars&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array)&nbsp;<B>return</B>&nbsp;chars_ptr;</div>
<div class="paranum">26</div>
<div class="Indented2">This function returns a pointer to an allocated 
object initialized to Chars(Chars'First .. Index) &amp; nul, where&nbsp;</div>
<div class="paranum">27</div>
<div class="Indented3Bulleted">Index = Chars'Last if Chars does not contain 
nul, or</div>
<div class="paranum">28</div>
<div class="Indented3Bulleted">Index is the smallest size_t value I such 
that Chars(I+1) = nul.&nbsp;</div>
<div class="paranum">28.1</div>
<div class="Indented2" style="margin-bottom: 0.9em">Storage_Error is 
propagated if the allocation fails.</div>
<div class="paranum">29</div>
<div class="Examples"><B>function</B>&nbsp;New_String&nbsp;(Str&nbsp;:&nbsp;<B>in</B>&nbsp;String)&nbsp;<B>return</B>&nbsp;chars_ptr;</div>
<div class="paranum">30</div>
<div class="Indented2" style="margin-bottom: 0.9em">This function is 
equivalent to New_Char_Array(To_C(Str)).</div>
<div class="paranum">31</div>
<div class="Examples"><B>procedure</B>&nbsp;Free&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;<B>out</B>&nbsp;chars_ptr);</div>
<div class="paranum">32</div>
<div class="Indented2" style="margin-bottom: 0.9em">If Item is Null_Ptr, 
then Free has no effect. Otherwise, Free releases the storage occupied 
by Value(Item), and resets Item to Null_Ptr.</div>
<div class="paranum">33</div>
<div class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;char_array;</div>
<div class="paranum">34</div>
<div class="Indented2" style="margin-bottom: 0.9em">If Item = Null_Ptr 
then Value propagates Dereference_Error. Otherwise Value returns the 
prefix of the array of chars pointed to by Item, up to and including 
the first nul. The lower bound of the result is 0. If Item does not point 
to a nul-terminated string, then execution of Value is erroneous.</div>
<div class="paranum">35</div>
<div class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;char_array;</div>
<div class="paranum">36/1</div>
<div class="Indented2" style="margin-bottom: 0.9em">{<I><A HREF="defect1.html#8652/0062">8652/0062</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00139.TXT">AI95-00139-01</A></I>} 
If Item = Null_Ptr then Value propagates Dereference_Error. Otherwise 
Value returns the shorter of two arrays, either the first Length chars 
pointed to by Item, or Value(Item). The lower bound of the result is 
0. If Length is 0, then Value propagates Constraint_Error.&nbsp;</div>
<div class="paranum">36.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Value(New_Char_Array(Chars)) 
= Chars if Chars does not contain nul; else Value(New_Char_Array( Chars)) 
is the prefix of Chars up to and including the first nul.&nbsp;</div>
<div class="paranum">37</div>
<div class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;String;</div>
<div class="paranum">38</div>
<div class="Indented2" style="margin-bottom: 0.9em">Equivalent to To_Ada(Value(Item), 
Trim_Nul=&gt;True).</div>
<div class="paranum">39</div>
<div class="Examples"><B>function</B>&nbsp;Value&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;&nbsp;Length&nbsp;:&nbsp;<B>in</B>&nbsp;size_t)<BR>
&nbsp;&nbsp;&nbsp;<B>return</B>&nbsp;String;</div>
<div class="paranum">40/1</div>
<div class="Indented2" style="margin-bottom: 0.9em">{<I><A HREF="defect1.html#8652/0063">8652/0063</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00177.TXT">AI95-00177-01</A></I>} 
Equivalent to To_Ada(Value(Item, Length) &amp; nul, Trim_Nul=&gt;True).</div>
<div class="paranum">41</div>
<div class="Examples"><B>function</B>&nbsp;Strlen&nbsp;(Item&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr)&nbsp;<B>return</B>&nbsp;size_t;</div>
<div class="paranum">42</div>
<div class="Indented2" style="margin-bottom: 0.9em">Returns <I>Val</I>'Length&ndash;1 
where <I>Val</I> = Value(Item); propagates Dereference_Error if Item 
= Null_Ptr.&nbsp;</div>
<div class="paranum">42.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>Strlen returns the number 
of chars in the array pointed to by Item, up to and including the char 
immediately before the first nul.</div>
<div class="paranum">42.b</div>
<div class="Annotations">Strlen has the same possibility for erroneous 
execution as Value, in cases where the string has not been nul-terminated.</div>
<div class="paranum">42.c</div>
<div class="Annotations">Strlen has the effect of C's strlen function. 
</div>
<div class="paranum">43</div>
<div class="Examples"><B>procedure</B>&nbsp;Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chars&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;char_array;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;Boolean&nbsp;:=&nbsp;True);</div>
<div class="paranum">44/1</div>
<div class="Indented2" style="margin-bottom: 0.4em">{<I><A HREF="defect1.html#8652/0064">8652/0064</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00039.TXT">AI95-00039-01</A></I>} 
If Item = Null_Ptr, then Update propagates Dereference_Error. Otherwise, 
this procedure updates the value pointed to by Item, starting at position 
Offset, using Chars as the data to be copied into the array. Overwriting 
the nul terminator, and skipping with the Offset past the nul terminator, 
are both prevented if Check is True, as follows:&nbsp;</div>
<div class="paranum">45</div>
<div class="Indented3Bulleted">Let N = Strlen(Item). If Check is True, 
then:&nbsp;</div>
<div class="paranum">46</div>
<div class="Indented4NestedBulleted">If Offset+Chars'Length&gt;N, propagate 
Update_Error.</div>
<div class="paranum">47</div>
<div class="Indented4NestedBulleted">Otherwise, overwrite the data in 
the array pointed to by Item, starting at the char at position Offset, 
with the data in Chars.&nbsp;</div>
<div class="paranum">48</div>
<div class="Indented3Bulleted" style="margin-bottom: 0.7em">If Check 
is False, then processing is as above, but with no check that Offset+Chars'Length&gt;N. 
</div>
<div class="paranum">48.a</div>
<div class="Annotations"><B>Ramification:&nbsp;</B>If Chars contains nul, 
Update's effect may be to &ldquo;shorten&rdquo; the pointed-to char array.</div>
<div class="paranum">49</div>
<div class="Examples"><B>procedure</B>&nbsp;Update&nbsp;(Item&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;chars_ptr;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Offset&nbsp;:&nbsp;<B>in</B>&nbsp;size_t;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Str&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;String;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;&nbsp;:&nbsp;<B>in</B>&nbsp;Boolean&nbsp;:=&nbsp;True);</div>
<div class="paranum">50/2</div>
<div class="Indented2">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00242.TXT">AI95-00242-01</A></I>} 
Equivalent to Update(Item, Offset, To_C(Str, Append_Nul =&gt; False), 
Check).&nbsp;</div>
<div class="paranum">50.a/2</div>
<div class="Annotations"><B>Discussion:&nbsp;</B>{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00242.TXT">AI95-00242-01</A></I>} 
To truncate the Item to the length of Str, use Update(Item, Offset, To_C(Str), 
Check) instead of Update(Item, Offset, Str, Check). Note that when truncating 
Item, Item must be longer than Str.&nbsp;</div>

<H4 Class="centered">Erroneous Execution</H4>
<div class="paranum">51</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I6989"></A>Execution of any of 
the following is erroneous if the Item parameter is not null_ptr and 
Item does not point to a nul-terminated array of chars.&nbsp;</div>
<div class="paranum">52</div>
<div class="Bulleted">a Value function not taking a Length parameter,</div>
<div class="paranum">53</div>
<div class="Bulleted">the Free procedure,</div>
<div class="paranum">54</div>
<div class="Bulleted">the Strlen function.&nbsp;</div>
<div class="paranum">55</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I6990"></A>Execution of Free(X) 
is also erroneous if the chars_ptr X was not returned by New_Char_Array 
or New_String.</div>
<div class="paranum">56</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I6991"></A>Reading or updating 
a freed char_array is erroneous.</div>
<div class="paranum">57</div>
<div class="Normal"><SPAN STYLE="font-size: 80%">{<I>erroneous execution 
(cause)</I> [partial]}</SPAN> <A NAME="I6992"></A>Execution of Update 
is erroneous if Check is False and a call with Check equal to True would 
have propagated Update_Error.&nbsp;</div>
<div class="NotesHeader">NOTES</div>
<div class="paranum">58</div>
<div class="Notes">11&nbsp;&nbsp;New_Char_Array and New_String might 
be implemented either through the allocation function from the C environment 
(&ldquo;malloc&rdquo;) or through Ada dynamic memory allocation (&ldquo;new&rdquo;). 
The key points are&nbsp;</div>
<div class="paranum">59</div>
<div class="Indented2SmallBulleted">the returned value (a chars_ptr) 
is represented as a C &ldquo;char *&rdquo; so that it may be passed to 
C functions;</div>
<div class="paranum">60</div>
<div class="Indented2SmallBulleted">the allocated object should be freed 
by the programmer via a call of Free, not by a called C function.&nbsp;</div>

<H4 Class="centered">Inconsistencies With Ada 95</H4>
<div class="paranum">60.a/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00242.TXT">AI95-00242-01</A></I>} 
{<I>inconsistencies with Ada 95</I>} <A NAME="I6993"></A><B>Amendment 
Correction:</B> Update for a String parameter is now defined to not add 
a nul character. It did add a nul in Ada 95. This means that programs 
that used this behavior of Update to truncate a string will no longer 
work (the string will not be truncated). This change makes Update for 
a string consistent with Update for a char_array (no implicit nul is 
added to the end of a char_array).&nbsp;</div>

<H4 Class="centered">Extensions to Ada 95</H4>
<div class="paranum">60.b/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00161.TXT">AI95-00161-01</A></I>} 
{<I>extensions to Ada 95</I>} <A NAME="I6994"></A><B>Amendment Correction:</B> 
Added <SPAN Class="swiss"><A HREF="AA-2-8.html#S0019">pragma</A></SPAN> 
Preelaborable_Initialization to type chars_ptr, so that it can be used 
in preelaborated units.</div>
<div class="paranum">60.c/2</div>
<div class="Annotations">{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00276.TXT">AI95-00276-01</A></I>} 
<B>Amendment Correction:</B> The components of chars_ptr_array are aliased 
so that it can be used to instantiate Interfaces.C.Pointers (that is 
its intended purpose, which is otherwise mysterious as it has no operations). 
</div>

<H4 Class="centered">Wording Changes from Ada 95</H4>
<div class="paranum">60.d/2</div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0061">8652/0061</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00140.TXT">AI95-00140-01</A></I>} 
<B>Corrigendum:</B> Fixed the missing semantics of To_Char_Ptr when Nul_Check 
is False.</div>
<div class="paranum">60.e/2</div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0062">8652/0062</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00139.TXT">AI95-00139-01</A></I>} 
<B>Corrigendum:</B> Fixed the missing semantics of Value when the Length 
is 0.</div>
<div class="paranum">60.f/2</div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0063">8652/0063</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00177.TXT">AI95-00177-01</A></I>} 
<B>Corrigendum:</B> Corrected the definition of Value to avoid raising 
Terminator_Error.</div>
<div class="paranum">60.g/2</div>
<div class="Annotations">{<I><A HREF="defect1.html#8652/0064">8652/0064</A></I>} 
{<I><A HREF="http://www.ada-auth.org/cgi-bin/cvsweb.cgi/AIs/AI-00039.TXT">AI95-00039-01</A></I>} 
<B>Corrigendum:</B> Fixed the missing semantics of Update when Item is 
Null_Ptr.&nbsp;</div>

<HR>
<div style="margin-top: 0.0em; margin-bottom: 0.6em"><A HREF="AA-TOC.html"><IMG SRC="cont.gif" ALT="Contents" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-0-5.html"><IMG SRC="index.gif" ALT="Index" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-STDS.html"><IMG SRC="lib.gif" ALT="References" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-SRCH.html"><IMG SRC="find.gif" ALT="Search" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3.html"><IMG SRC="prev.gif" ALT="Previous" BORDER=0></A>&nbsp;
&nbsp;<A HREF="AA-B-3-2.html"><IMG SRC="next.gif" ALT="Next" BORDER=0></A>&nbsp;
</div>
<DIV Style="margin-top:0.0em"><IMG SRC="AE_logo.gif" height=100 width=113 align=right ALT="Ada-Europe">
<SPAN Style="font-size: 125%">Sponsored by <SPAN Style="font-size: 125%"><A HREF="http://www.ada-europe.org/"><B>Ada-Europe</B></A></SPAN></SPAN></DIV>
</BODY>
</HTML>
