<!-- Creator     : groff version 1.21 -->
<!-- CreationDate: Sat May  5 10:27:20 2012 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>Ns_ConnType</title>

</head>
<body>

<h1 align="center">Ns_ConnType</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#ARGUMENTS">ARGUMENTS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#CHARSETS AND ENCODINGS">CHARSETS AND ENCODINGS</a><br>
<a href="#EXAMPLES">EXAMPLES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#KEYWORDS">KEYWORDS</a><br>

<hr>



<p style="margin-top: 1em">______________________________________________________________________________</p>

<h2>NAME
<a name="NAME"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Ns_ConnGetType,
Ns_ConnSetType &minus; Routines to manage the HTTP response
type</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&quot;ns.h&quot;</b></p>

<p style="margin-left:11%; margin-top: 1em">char * <b><br>
Ns_ConnGetType</b>(<i>conn</i>)</p>

<p style="margin-left:11%; margin-top: 1em">void <b><br>
Ns_ConnSetType</b>(<i>conn, type</i>)</p>

<h2>ARGUMENTS
<a name="ARGUMENTS"></a>
</h2>


<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="32%">


<p style="margin-top: 1em">Ns_Conn <i>conn</i> (in)</p></td>
<td width="9%"></td>
<td width="48%">


<p style="margin-top: 1em">Pointer to open connection.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="32%">


<p>char <i>*type</i> (in)</p></td>
<td width="9%"></td>
<td width="48%">


<p>Character string with response mimetype.</p></td></tr>
</table>


<p style="margin-left:52%;">_________________________________________________________________</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">These routines
both manage the eventual <i>content-type</i> header which is
generated by a later call to <b>Ns_ConnFlush</b> or
<b>Ns_ConnFlushDirect</b> as well as manage the appropriate
character encoding for text output types. <br>
char *<b>Ns_ConnGetType</b>(<i>conn</i>)</p>

<p style="margin-left:22%;">Return the current HTTP mime
type (e.g., &quot;text/html; charset=iso-8859-1&quot;) or
NULL if no type has yet been set.</p>

<p style="margin-left:11%;">void
<b>Ns_ConnSetType</b>(<i>conn, type</i>)</p>

<p style="margin-left:22%;">Sets the mimetype of the
response to the given <i>type</i>. A later call to
<b>Ns_ConnFlush</b> will include a header of the form
<i>content-type: type</i> when generating the response.</p>

<h2>CHARSETS AND ENCODINGS
<a name="CHARSETS AND ENCODINGS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For text types,
a call to <b>Ns_ConnSetType</b> can also include an optional
&quot;charset=&quot; attribute. If no <i>charset</i> is
specified, the server will append a default charset if
specified as the <i>outputcharset</i> server configuration
variable.</p>

<p style="margin-left:11%; margin-top: 1em">With a given or
automatically appended charset for text types, the server
will then set the output encoding to the cooresponding
Tcl_Encoding, for example, mapping the charset
&quot;iso-8859-1&quot; to the Tcl_Encoding equivalent
&quot;iso8859-1&quot;. All text later sent via
<b>Ns_ConnFlush</b> will be first encoded using the
determined Tcl_Encoding (calls to <b>Ns_ConnFlushDirect</b>
will bypass this encoding step). See the man pages on
<b>Ns_GetCharsetEncoding</b> for details on how these
mappings are configured.</p>

<p style="margin-left:11%; margin-top: 1em">The charset
modification feature was added in later versions of
AOLserver to support legacy code which may have been
sprinkled with direct calls to set text types without
specifying the charset, e.g., calls such as:</p>

<p style="margin-left:22%; margin-top: 1em">ns_return 200
text/html &quot;&lt;body&gt;hello&lt;/body&gt;&quot;</p>

<h2>EXAMPLES
<a name="EXAMPLES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The following
example demonstrates sending Japanese character data. In
this case, assume &quot;utf8string&quot; contains a series
of UTF-8 bytes with various Japanese characters. The call to
<b>Ns_ConnSetType</b> will setup the appropriate
&quot;shiftjis&quot; output Tcl_Encoding to match the given
&quot;shift_jis&quot; charset:</p>


<p style="margin-left:22%; margin-top: 1em">Ns_ConnSetStatus(conn,
200);</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="3%"></td>
<td width="5%"></td>
<td width="92%">


<p>Ns_ConnSetType(conn, &quot;text/html;
charset=shift_jis&quot;);</p> </td></tr>
<tr valign="top" align="left">
<td width="3%"></td>
<td width="5%"></td>
<td width="92%">


<p>Ns_ConnFlushDirect(conn, utf8string, -1, 0);</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">The following
demonstrates the behavior of the default server charset
encoding. Assume the following is set in the config
file:</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="3%"></td>
<td width="97%">


<p>ns_section ns/server/serverName</p></td></tr>
<tr valign="top" align="left">
<td width="3%"></td>
<td width="97%">


<p>ns_param outputcharset iso-8859-1</p></td></tr>
</table>

<p style="margin-left:11%; margin-top: 1em">In this case, a
call to <b>Ns_ConnSetType</b>(<i>conn,
&quot;text/html&quot;</i>) without a specific charset would
be modified to include &quot;charset=iso-8859-1&quot;. Based
on this modification, the output encoding would be set to
the &quot;iso8859-1&quot; Tcl_Encoding.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em">Ns_ConnGetType(3),
Ns_ConnSetType(3), Ns_ConnFlush(3), Ns_ConnFlushDirect(3),
Ns_ConnSetRequiredHeaders(3), Ns_ConnQueueHeaders(3),
Ns_GetCharsetEncoding(3), Ns_GetTypeEncoding(3),
ns_conn(n)</p>

<h2>KEYWORDS
<a name="KEYWORDS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">connectionn,
response, status, encoding, charset</p>
<hr>
</body>
</html>
