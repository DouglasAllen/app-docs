

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Variables &mdash; Ansible Documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.01',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Ansible Documentation" href="index.html" />
    <link rel="up" title="Playbooks" href="playbooks.html" />
    <link rel="next" title="Conditionals" href="playbooks_conditionals.html" />
    <link rel="prev" title="Playbook Roles and Include Statements" href="playbooks_roles.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="playbooks_conditionals.html" title="Conditionals"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="playbooks_roles.html" title="Playbook Roles and Include Statements"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Ansible Documentation</a> &raquo;</li>
          <li><a href="playbooks.html" accesskey="U">Playbooks</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="variables">
<h1><a class="toc-backref" href="#id12">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="#variables" id="id12">Variables</a><ul>
<li><a class="reference internal" href="#what-makes-a-valid-variable-name" id="id13">What Makes A Valid Variable Name</a></li>
<li><a class="reference internal" href="#variables-defined-in-inventory" id="id14">Variables Defined in Inventory</a></li>
<li><a class="reference internal" href="#variables-defined-in-a-playbook" id="id15">Variables Defined in a Playbook</a></li>
<li><a class="reference internal" href="#variables-defined-from-included-files-and-roles" id="id16">Variables defined from included files and roles</a></li>
<li><a class="reference internal" href="#using-variables-about-jinja2" id="id17">Using Variables: About Jinja2</a></li>
<li><a class="reference internal" href="#jinja2-filters" id="id18">Jinja2 Filters</a><ul>
<li><a class="reference internal" href="#filters-for-formatting-data" id="id19">Filters For Formatting Data</a></li>
<li><a class="reference internal" href="#filters-often-used-with-conditionals" id="id20">Filters Often Used With Conditionals</a></li>
<li><a class="reference internal" href="#forcing-variables-to-be-defined" id="id21">Forcing Variables To Be Defined</a></li>
<li><a class="reference internal" href="#defaulting-undefined-variables" id="id22">Defaulting Undefined Variables</a></li>
<li><a class="reference internal" href="#set-theory-filters" id="id23">Set Theory Filters</a></li>
<li><a class="reference internal" href="#version-comparison-filters" id="id24">Version Comparison Filters</a></li>
<li><a class="reference internal" href="#random-number-filter" id="id25">Random Number Filter</a></li>
<li><a class="reference internal" href="#other-useful-filters" id="id26">Other Useful Filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hey-wait-a-yaml-gotcha" id="id27">Hey Wait, A YAML Gotcha</a></li>
<li><a class="reference internal" href="#information-discovered-from-systems-facts" id="id28">Information discovered from systems: Facts</a></li>
<li><a class="reference internal" href="#turning-off-facts" id="id29">Turning Off Facts</a></li>
<li><a class="reference internal" href="#local-facts-facts-d" id="id30">Local Facts (Facts.d)</a></li>
<li><a class="reference internal" href="#registered-variables" id="id31">Registered Variables</a></li>
<li><a class="reference internal" href="#accessing-complex-variable-data" id="id32">Accessing Complex Variable Data</a></li>
<li><a class="reference internal" href="#magic-variables-and-how-to-access-information-about-other-hosts" id="id33">Magic Variables, and How To Access Information About Other Hosts</a></li>
<li><a class="reference internal" href="#variable-file-separation" id="id34">Variable File Separation</a></li>
<li><a class="reference internal" href="#passing-variables-on-the-command-line" id="id35">Passing Variables On The Command Line</a></li>
<li><a class="reference internal" href="#conditional-imports" id="id36">Conditional Imports</a></li>
<li><a class="reference internal" href="#variable-precedence-where-should-i-put-a-variable" id="id37">Variable Precedence: Where Should I Put A Variable?</a></li>
</ul>
</li>
</ul>
</div>
<p>While automation exists to make it easier to make things repeatable, all of your systems are likely not exactly alike.</p>
<p>All of your systems are likely not the same.  On some systems you may want to set some behavior
or configuration that is slightly different from others.</p>
<p>Also, some of the observed behavior or state
of remote systems might need to influence how you configure those systems.  (Such as you might need to find out the IP
address of a system and even use it as a configuration value on another system).</p>
<p>You might have some templates for configuration files that are mostly the same, but slightly different
based on those variables.</p>
<p>Variables in Ansible are how we deal with differences between systems.</p>
<p>Once understanding variables you&#8217;ll also want to dig into <a class="reference internal" href="playbooks_conditionals.html"><em>Conditionals</em></a> and <a class="reference internal" href="playbooks_loops.html"><em>Loops</em></a>.
Useful things like the &#8220;group_by&#8221; module
and the &#8220;when&#8221; conditional can also be used with variables, and to help manage differences between systems.</p>
<p>It&#8217;s highly recommended that you consult the ansible-examples github repository to see a lot of examples of variables put to use.</p>
<div class="section" id="what-makes-a-valid-variable-name">
<span id="valid-variable-names"></span><h2><a class="toc-backref" href="#id13">What Makes A Valid Variable Name</a><a class="headerlink" href="#what-makes-a-valid-variable-name" title="Permalink to this headline">¶</a></h2>
<p>Before we start using variables it&#8217;s important to know what are valid variable names.</p>
<p>Variable names should be letters, numbers, and underscores.  Variables should always start with a letter.</p>
<p>&#8220;foo_port&#8221; is a great variable.  &#8220;foo5&#8221; is fine too.</p>
<p>&#8220;foo-port&#8221;, &#8220;foo port&#8221;, &#8220;foo.port&#8221; and &#8220;12&#8221; are not valid variable names.</p>
<p>Easy enough, let&#8217;s move on.</p>
</div>
<div class="section" id="variables-defined-in-inventory">
<span id="variables-in-inventory"></span><h2><a class="toc-backref" href="#id14">Variables Defined in Inventory</a><a class="headerlink" href="#variables-defined-in-inventory" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;ve actually already covered a lot about variables in another section, so far this shouldn&#8217;t be terribly new, but
a bit of a refresher.</p>
<p>Often you&#8217;ll want to set variables based on what groups a machine is in.  For instance, maybe machines in Boston
want to use &#8216;boston.ntp.example.com&#8217; as an NTP server.</p>
<p>See the <a class="reference internal" href="intro_inventory.html"><em>Inventory</em></a> document for multiple ways on how to define variables in inventory.</p>
</div>
<div class="section" id="variables-defined-in-a-playbook">
<span id="playbook-variables"></span><h2><a class="toc-backref" href="#id15">Variables Defined in a Playbook</a><a class="headerlink" href="#variables-defined-in-a-playbook" title="Permalink to this headline">¶</a></h2>
<p>In a playbook, it&#8217;s possible to define variables directly inline like so:</p>
<div class="highlight-python"><pre>- hosts: webservers
  vars:
    http_port: 80</pre>
</div>
<p>This can be nice as it&#8217;s right there when you are reading the playbook.</p>
</div>
<div class="section" id="variables-defined-from-included-files-and-roles">
<span id="included-variables"></span><h2><a class="toc-backref" href="#id16">Variables defined from included files and roles</a><a class="headerlink" href="#variables-defined-from-included-files-and-roles" title="Permalink to this headline">¶</a></h2>
<p>It turns out we&#8217;ve already talked about variables in another place too.</p>
<p>As described in <a class="reference internal" href="playbooks_roles.html"><em>Playbook Roles and Include Statements</em></a>, variables can also be included in the playbook via include files, which may or may
not be part of an &#8220;Ansible Role&#8221;.  Usage of roles is preferred as it provides a nice organizational system.</p>
</div>
<div class="section" id="using-variables-about-jinja2">
<span id="about-jinja2"></span><h2><a class="toc-backref" href="#id17">Using Variables: About Jinja2</a><a class="headerlink" href="#using-variables-about-jinja2" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s nice enough to know about how to define variables, but how do you use them?</p>
<p>Ansible allows you to
reference variables in your playbooks using the Jinja2 templating system.  While you can do a lot of complex
things in Jinja, only the basics are things you really need to learn at first.</p>
<p>For instance, in a simple template, you can do something like:</p>
<div class="highlight-python"><pre>My amp goes to {{ max_amp_value }}</pre>
</div>
<p>And that will provide the most basic form of variable substitution.</p>
<p>This is also valid directly in playbooks, and you&#8217;ll occasionally want to do things like:</p>
<div class="highlight-python"><pre>template: src=foo.cfg.j2 dest={{ remote_install_path }}/foo.cfg</pre>
</div>
<p>In the above example, we used a variable to help decide where to place a file.</p>
<p>Inside a template you automatically have access to all of the variables that are in scope for a host.  Actually
it&#8217;s more than that &#8211; you can also read variables about other hosts.  We&#8217;ll show how to do that in a bit.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ansible allows Jinja2 loops and conditionals in templates, but in playbooks, we do not use them.  Ansible
playbooks are pure machine-parseable YAML.  This is a rather important feature as it means it is possible to code-generate
pieces of files, or to have other ecosystem tools read Ansible files.  Not everyone will need this but it can unlock
possibilities.</p>
</div>
</div>
<div class="section" id="jinja2-filters">
<span id="id1"></span><h2><a class="toc-backref" href="#id18">Jinja2 Filters</a><a class="headerlink" href="#jinja2-filters" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These are infrequently utilized features.  Use them if they fit a use case you have, but this is optional knowledge.</p>
</div>
<p>Filters in Jinja2 are a way of transforming template expressions from one kind of data into another.  Jinja2
ships with many of these. See <a class="reference external" href="http://jinja.pocoo.org/docs/templates/#builtin-filters">builtin filters</a> in the official Jinja2 template documentation.</p>
<p>In addition to those, Ansible supplies many more.</p>
<div class="section" id="filters-for-formatting-data">
<span id="id2"></span><h3><a class="toc-backref" href="#id19">Filters For Formatting Data</a><a class="headerlink" href="#filters-for-formatting-data" title="Permalink to this headline">¶</a></h3>
<p>The following filters will take a data structure in a template and render it in a slightly different format.  These
are occasionally useful for debugging:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">some_variable</span> <span class="o">|</span> <span class="n">to_nice_json</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="n">some_variable</span> <span class="o">|</span> <span class="n">to_nice_yaml</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="filters-often-used-with-conditionals">
<span id="filters-used-with-conditionals"></span><h3><a class="toc-backref" href="#id20">Filters Often Used With Conditionals</a><a class="headerlink" href="#filters-often-used-with-conditionals" title="Permalink to this headline">¶</a></h3>
<p>The following tasks are illustrative of how filters can be used with conditionals:</p>
<div class="highlight-python"><pre>tasks:

  - shell: /usr/bin/foo
    register: result
    ignore_errors: True

  - debug: msg="it failed"
    when: result|failed

  # in most cases you'll want a handler, but if you want to do something right now, this is nice
  - debug: msg="it changed"
    when: result|changed

  - debug: msg="it succeeded"
    when: result|success

  - debug: msg="it was skipped"
    when: result|skipped</pre>
</div>
</div>
<div class="section" id="forcing-variables-to-be-defined">
<span id="id3"></span><h3><a class="toc-backref" href="#id21">Forcing Variables To Be Defined</a><a class="headerlink" href="#forcing-variables-to-be-defined" title="Permalink to this headline">¶</a></h3>
<p>The default behavior from ansible and ansible.cfg is to fail if variables are undefined, but you can turn this off.</p>
<p>This allows an explicit check with this feature off:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">variable</span> <span class="o">|</span> <span class="n">mandatory</span> <span class="p">}}</span>
</pre></div>
</div>
<p>The variable value will be used as is, but the template evaluation will raise an error if it is undefined.</p>
</div>
<div class="section" id="defaulting-undefined-variables">
<span id="id4"></span><h3><a class="toc-backref" href="#id22">Defaulting Undefined Variables</a><a class="headerlink" href="#defaulting-undefined-variables" title="Permalink to this headline">¶</a></h3>
<p>Jinja2 provides a useful &#8216;default&#8217; filter, that is often a better approach to failing if a variable is not defined:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">some_variable</span> <span class="o">|</span> <span class="n">default</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>In the above example, if the variable &#8216;some_variable&#8217; is not defined, the value used will be 5, rather than an error
being raised.</p>
</div>
<div class="section" id="set-theory-filters">
<span id="id5"></span><h3><a class="toc-backref" href="#id23">Set Theory Filters</a><a class="headerlink" href="#set-theory-filters" title="Permalink to this headline">¶</a></h3>
<p>All these functions return a unique set from sets or lists.</p>
<p class="versionadded">
<span class="versionmodified">New in version 1.4.</span></p>
<p>To get a unique set from a list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">list1</span> <span class="o">|</span> <span class="n">unique</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To get a union of two lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">list1</span> <span class="o">|</span> <span class="n">union</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To get the intersection of 2 lists (unique list of all items in both):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">list1</span> <span class="o">|</span> <span class="n">intersect</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To get the difference of 2 lists (items in 1 that don&#8217;t exist in 2):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">list1</span> <span class="o">|</span> <span class="n">difference</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To get the symmetric difference of 2 lists (items exclusive to each list):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">list1</span> <span class="o">|</span> <span class="n">symmetric_difference</span><span class="p">(</span><span class="n">list2</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="version-comparison-filters">
<span id="id6"></span><h3><a class="toc-backref" href="#id24">Version Comparison Filters</a><a class="headerlink" href="#version-comparison-filters" title="Permalink to this headline">¶</a></h3>
<p class="versionadded">
<span class="versionmodified">New in version 1.6.</span></p>
<p>To compare a version number, such as checking if the <tt class="docutils literal"><span class="pre">ansible_distribution_version</span></tt>
version is greater than or equal to &#8216;12.04&#8217;, you can use the <tt class="docutils literal"><span class="pre">version_compare</span></tt> filter.</p>
<p>The <tt class="docutils literal"><span class="pre">version_compare</span></tt> filter can also be used to evaluate the <tt class="docutils literal"><span class="pre">ansible_distribution_version</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">ansible_distribution_version</span> <span class="o">|</span> <span class="n">version_compare</span><span class="p">(</span><span class="s">&#39;12.04&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>If <tt class="docutils literal"><span class="pre">ansible_distribution_version</span></tt> is greater than or equal to 12, this filter will return True, otherwise it will return False.</p>
<p>The <tt class="docutils literal"><span class="pre">version_compare</span></tt> filter accepts the following operators:</p>
<div class="highlight-python"><pre>&lt;, lt, &lt;=, le, &gt;, gt, &gt;=, ge, ==, =, eq, !=, &lt;&gt;, ne</pre>
</div>
<p>This filter also accepts a 3rd parameter, <tt class="docutils literal"><span class="pre">strict</span></tt> which defines if strict version parsing should
be used.  The default is <tt class="docutils literal"><span class="pre">False</span></tt>, and if set as <tt class="docutils literal"><span class="pre">True</span></tt> will use more strict version parsing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">sample_version_var</span> <span class="o">|</span> <span class="n">version_compare</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s">&#39;lt&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="random-number-filter">
<span id="random-filter"></span><h3><a class="toc-backref" href="#id25">Random Number Filter</a><a class="headerlink" href="#random-number-filter" title="Permalink to this headline">¶</a></h3>
<p class="versionadded">
<span class="versionmodified">New in version 1.6.</span></p>
<p>This filter can be used similar to the default jinja2 random filter (returning a random item from a sequence of
items), but can also generate a random number based on a range.</p>
<p>To get a random item from a list:</p>
<div class="highlight-python"><pre>{{ ['a','b','c']|random }} =&gt; 'c'</pre>
</div>
<p>To get a random number from 0 to supplied end:</p>
<div class="highlight-python"><pre>{{ 59 |random}} * * * * root /script/from/cron</pre>
</div>
<p>Get a random number from 0 to 100 but in steps of 10:</p>
<div class="highlight-python"><pre>{{ 100 |random(step=10) }}  =&gt; 70</pre>
</div>
<p>Get a random number from 1 to 100 but in steps of 10:</p>
<div class="highlight-python"><pre>{{ 100 |random(1, 10) }}    =&gt; 31
{{ 100 |random(start=1, step=10) }}    =&gt; 51</pre>
</div>
</div>
<div class="section" id="other-useful-filters">
<span id="id7"></span><h3><a class="toc-backref" href="#id26">Other Useful Filters</a><a class="headerlink" href="#other-useful-filters" title="Permalink to this headline">¶</a></h3>
<p>To concatenate a list into a string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To get the last name of a file path, like &#8216;foo.txt&#8217; out of &#8216;/etc/asdf/foo.txt&#8217;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">path</span> <span class="o">|</span> <span class="n">basename</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To get the directory from a path:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">path</span> <span class="o">|</span> <span class="n">dirname</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To expand a path containing a tilde (<cite>~</cite>) character (new in version 1.5):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">path</span> <span class="o">|</span> <span class="n">expanduser</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To work with Base64 encoded strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">encoded</span> <span class="o">|</span> <span class="n">b64decode</span> <span class="p">}}</span>
<span class="p">{{</span> <span class="n">decoded</span> <span class="o">|</span> <span class="n">b64encode</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To take an md5sum of a filename:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">filename</span> <span class="o">|</span> <span class="n">md5</span> <span class="p">}}</span>
</pre></div>
</div>
<p>To cast values as certain types, such as when you input a string as &#8220;True&#8221; from a vars_prompt and the system
doesn&#8217;t know it is a boolean value:</p>
<div class="highlight-python"><pre>- debug: msg=test
  when: some_string_value | bool</pre>
</div>
<p>To match strings against a regex, use the &#8220;match&#8221; or &#8220;search&#8221; filter:</p>
<div class="highlight-python"><pre>vars:
  url: "http://example.com/users/foo/resources/bar"

tasks:
    - shell: "msg='matched pattern 1'"
      when: url | match("http://example.com/users/.*/resources/.*")

    - debug: "msg='matched pattern 2'"
      when: url | search("/users/.*/resources/.*")</pre>
</div>
<p>&#8216;match&#8217; will require a complete match in the string, while &#8216;search&#8217; will require a match inside of the string.</p>
<p>To replace text in a string with regex, use the &#8220;regex_replace&#8221; filter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># convert &quot;ansible&quot; to &quot;able&quot;</span>
<span class="p">{{</span> <span class="s">&#39;ansible&#39;</span> <span class="o">|</span> <span class="n">regex_replace</span><span class="p">(</span><span class="s">&#39;^a.*i(.*)$&#39;</span><span class="p">,</span> <span class="s">&#39;a</span><span class="se">\\</span><span class="s">1&#39;</span><span class="p">)</span> <span class="p">}}</span>

<span class="c"># convert &quot;foobar&quot; to &quot;bar&quot;</span>
<span class="p">{{</span> <span class="s">&#39;foobar&#39;</span> <span class="o">|</span> <span class="n">regex_replace</span><span class="p">(</span><span class="s">&#39;^f.*o(.*)$&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">1&#39;</span><span class="p">)</span> <span class="p">}}</span>
</pre></div>
</div>
<p>A few useful filters are typically added with each new Ansible release.  The development documentation shows
how to extend Ansible filters by writing your own as plugins, though in general, we encourage new ones
to be added to core so everyone can make use of them.</p>
</div>
</div>
<div class="section" id="hey-wait-a-yaml-gotcha">
<span id="yaml-gotchas"></span><h2><a class="toc-backref" href="#id27">Hey Wait, A YAML Gotcha</a><a class="headerlink" href="#hey-wait-a-yaml-gotcha" title="Permalink to this headline">¶</a></h2>
<p>YAML syntax requires that if you start a value with {{ foo }} you quote the whole line, since it wants to be
sure you aren&#8217;t trying to start a YAML dictionary.  This is covered on the <a class="reference internal" href="YAMLSyntax.html"><em>YAML Syntax</em></a> page.</p>
<p>This won&#8217;t work:</p>
<div class="highlight-python"><pre>- hosts: app_servers
  vars:
      app_path: {{ base_path }}/22</pre>
</div>
<p>Do it like this and you&#8217;ll be fine:</p>
<div class="highlight-python"><pre>- hosts: app_servers
  vars:
       app_path: "{{ base_path }}/22"</pre>
</div>
</div>
<div class="section" id="information-discovered-from-systems-facts">
<span id="vars-and-facts"></span><h2><a class="toc-backref" href="#id28">Information discovered from systems: Facts</a><a class="headerlink" href="#information-discovered-from-systems-facts" title="Permalink to this headline">¶</a></h2>
<p>There are other places where variables can come from, but these are a type of variable that are discovered, not set by the user.</p>
<p>Facts are information derived from speaking with your remote systems.</p>
<p>An example of this might be the ip address of the remote host, or what the operating system is.</p>
<p>To see what information is available, try the following:</p>
<div class="highlight-python"><pre>ansible hostname -m setup</pre>
</div>
<p>This will return a ginormous amount of variable data, which may look like this, as taken from Ansible 1.4 on a Ubuntu 12.04 system:</p>
<div class="highlight-python"><pre>"ansible_all_ipv4_addresses": [
    "REDACTED IP ADDRESS"
],
"ansible_all_ipv6_addresses": [
    "REDACTED IPV6 ADDRESS"
],
"ansible_architecture": "x86_64",
"ansible_bios_date": "09/20/2012",
"ansible_bios_version": "6.00",
"ansible_cmdline": {
    "BOOT_IMAGE": "/boot/vmlinuz-3.5.0-23-generic",
    "quiet": true,
    "ro": true,
    "root": "UUID=4195bff4-e157-4e41-8701-e93f0aec9e22",
    "splash": true
},
"ansible_date_time": {
    "date": "2013-10-02",
    "day": "02",
    "epoch": "1380756810",
    "hour": "19",
    "iso8601": "2013-10-02T23:33:30Z",
    "iso8601_micro": "2013-10-02T23:33:30.036070Z",
    "minute": "33",
    "month": "10",
    "second": "30",
    "time": "19:33:30",
    "tz": "EDT",
    "year": "2013"
},
"ansible_default_ipv4": {
    "address": "REDACTED",
    "alias": "eth0",
    "gateway": "REDACTED",
    "interface": "eth0",
    "macaddress": "REDACTED",
    "mtu": 1500,
    "netmask": "255.255.255.0",
    "network": "REDACTED",
    "type": "ether"
},
"ansible_default_ipv6": {},
"ansible_devices": {
    "fd0": {
        "holders": [],
        "host": "",
        "model": null,
        "partitions": {},
        "removable": "1",
        "rotational": "1",
        "scheduler_mode": "deadline",
        "sectors": "0",
        "sectorsize": "512",
        "size": "0.00 Bytes",
        "support_discard": "0",
        "vendor": null
    },
    "sda": {
        "holders": [],
        "host": "SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)",
        "model": "VMware Virtual S",
        "partitions": {
            "sda1": {
                "sectors": "39843840",
                "sectorsize": 512,
                "size": "19.00 GB",
                "start": "2048"
            },
            "sda2": {
                "sectors": "2",
                "sectorsize": 512,
                "size": "1.00 KB",
                "start": "39847934"
            },
            "sda5": {
                "sectors": "2093056",
                "sectorsize": 512,
                "size": "1022.00 MB",
                "start": "39847936"
            }
        },
        "removable": "0",
        "rotational": "1",
        "scheduler_mode": "deadline",
        "sectors": "41943040",
        "sectorsize": "512",
        "size": "20.00 GB",
        "support_discard": "0",
        "vendor": "VMware,"
    },
    "sr0": {
        "holders": [],
        "host": "IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)",
        "model": "VMware IDE CDR10",
        "partitions": {},
        "removable": "1",
        "rotational": "1",
        "scheduler_mode": "deadline",
        "sectors": "2097151",
        "sectorsize": "512",
        "size": "1024.00 MB",
        "support_discard": "0",
        "vendor": "NECVMWar"
    }
},
"ansible_distribution": "Ubuntu",
"ansible_distribution_release": "precise",
"ansible_distribution_version": "12.04",
"ansible_domain": "",
"ansible_env": {
    "COLORTERM": "gnome-terminal",
    "DISPLAY": ":0",
    "HOME": "/home/mdehaan",
    "LANG": "C",
    "LESSCLOSE": "/usr/bin/lesspipe %s %s",
    "LESSOPEN": "| /usr/bin/lesspipe %s",
    "LOGNAME": "root",
    "LS_COLORS": "rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:",
    "MAIL": "/var/mail/root",
    "OLDPWD": "/root/ansible/docsite",
    "PATH": "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
    "PWD": "/root/ansible",
    "SHELL": "/bin/bash",
    "SHLVL": "1",
    "SUDO_COMMAND": "/bin/bash",
    "SUDO_GID": "1000",
    "SUDO_UID": "1000",
    "SUDO_USER": "mdehaan",
    "TERM": "xterm",
    "USER": "root",
    "USERNAME": "root",
    "XAUTHORITY": "/home/mdehaan/.Xauthority",
    "_": "/usr/local/bin/ansible"
},
"ansible_eth0": {
    "active": true,
    "device": "eth0",
    "ipv4": {
        "address": "REDACTED",
        "netmask": "255.255.255.0",
        "network": "REDACTED"
    },
    "ipv6": [
        {
            "address": "REDACTED",
            "prefix": "64",
            "scope": "link"
        }
    ],
    "macaddress": "REDACTED",
    "module": "e1000",
    "mtu": 1500,
    "type": "ether"
},
"ansible_form_factor": "Other",
"ansible_fqdn": "ubuntu2",
"ansible_hostname": "ubuntu2",
"ansible_interfaces": [
    "lo",
    "eth0"
],
"ansible_kernel": "3.5.0-23-generic",
"ansible_lo": {
    "active": true,
    "device": "lo",
    "ipv4": {
        "address": "127.0.0.1",
        "netmask": "255.0.0.0",
        "network": "127.0.0.0"
    },
    "ipv6": [
        {
            "address": "::1",
            "prefix": "128",
            "scope": "host"
        }
    ],
    "mtu": 16436,
    "type": "loopback"
},
"ansible_lsb": {
    "codename": "precise",
    "description": "Ubuntu 12.04.2 LTS",
    "id": "Ubuntu",
    "major_release": "12",
    "release": "12.04"
},
"ansible_machine": "x86_64",
"ansible_memfree_mb": 74,
"ansible_memtotal_mb": 991,
"ansible_mounts": [
    {
        "device": "/dev/sda1",
        "fstype": "ext4",
        "mount": "/",
        "options": "rw,errors=remount-ro",
        "size_available": 15032406016,
        "size_total": 20079898624
    }
],
"ansible_os_family": "Debian",
"ansible_pkg_mgr": "apt",
"ansible_processor": [
    "Intel(R) Core(TM) i7 CPU         860  @ 2.80GHz"
],
"ansible_processor_cores": 1,
"ansible_processor_count": 1,
"ansible_processor_threads_per_core": 1,
"ansible_processor_vcpus": 1,
"ansible_product_name": "VMware Virtual Platform",
"ansible_product_serial": "REDACTED",
"ansible_product_uuid": "REDACTED",
"ansible_product_version": "None",
"ansible_python_version": "2.7.3",
"ansible_selinux": false,
"ansible_ssh_host_key_dsa_public": "REDACTED KEY VALUE"
"ansible_ssh_host_key_ecdsa_public": "REDACTED KEY VALUE"
"ansible_ssh_host_key_rsa_public": "REDACTED KEY VALUE"
"ansible_swapfree_mb": 665,
"ansible_swaptotal_mb": 1021,
"ansible_system": "Linux",
"ansible_system_vendor": "VMware, Inc.",
"ansible_user_id": "root",
"ansible_userspace_architecture": "x86_64",
"ansible_userspace_bits": "64",
"ansible_virtualization_role": "guest",
"ansible_virtualization_type": "VMware"</pre>
</div>
<p>In the above the model of the first harddrive may be referenced in a template or playbook as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">ansible_devices</span><span class="o">.</span><span class="n">sda</span><span class="o">.</span><span class="n">model</span> <span class="p">}}</span>
</pre></div>
</div>
<p>Similarly, the hostname as the system reports it is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">ansible_hostname</span> <span class="p">}}</span>
</pre></div>
</div>
<p>Facts are frequently used in conditionals (see <a class="reference internal" href="playbooks_conditionals.html"><em>Conditionals</em></a>) and also in templates.</p>
<p>Facts can be also used to create dynamic groups of hosts that match particular criteria, see the <a class="reference internal" href="modules.html"><em>About Modules</em></a> documentation on &#8216;group_by&#8217; for details, as well as in generalized conditional statements as discussed in the <a class="reference internal" href="playbooks_conditionals.html"><em>Conditionals</em></a> chapter.</p>
</div>
<div class="section" id="turning-off-facts">
<span id="disabling-facts"></span><h2><a class="toc-backref" href="#id29">Turning Off Facts</a><a class="headerlink" href="#turning-off-facts" title="Permalink to this headline">¶</a></h2>
<p>If you know you don&#8217;t need any fact data about your hosts, and know everything about your systems centrally, you
can turn off fact gathering.  This has advantages in scaling Ansible in push mode with very large numbers of
systems, mainly, or if you are using Ansible on experimental platforms.   In any play, just do this:</p>
<div class="highlight-python"><pre>- hosts: whatever
  gather_facts: no</pre>
</div>
</div>
<div class="section" id="local-facts-facts-d">
<span id="local-facts"></span><h2><a class="toc-backref" href="#id30">Local Facts (Facts.d)</a><a class="headerlink" href="#local-facts-facts-d" title="Permalink to this headline">¶</a></h2>
<p class="versionadded">
<span class="versionmodified">New in version 1.3.</span></p>
<p>As discussed in the playbooks chapter, Ansible facts are a way of getting data about remote systems for use in playbook variables.</p>
<p>Usually these are discovered automatically by the &#8216;setup&#8217; module in Ansible. Users can also write custom facts modules, as described
in the API guide.  However, what if you want to have a simple way to provide system or user
provided data for use in Ansible variables, without writing a fact module?</p>
<p>For instance, what if you want users to be able to control some aspect about how their systems are managed? &#8220;Facts.d&#8221; is one such mechanism.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Perhaps &#8220;local facts&#8221; is a bit of a misnomer, it means &#8220;locally supplied user values&#8221; as opposed to &#8220;centrally supplied user values&#8221;, or what facts are &#8211; &#8220;locally dynamically determined values&#8221;.</p>
</div>
<p>If a remotely managed system has an &#8220;/etc/ansible/facts.d&#8221; directory, any files in this directory
ending in &#8221;.fact&#8221;, can be JSON, INI, or executable files returning JSON, and these can supply local facts in Ansible.</p>
<p>For instance assume a /etc/ansible/facts.d/preferences.fact:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">general</span><span class="p">]</span>
<span class="n">asdf</span><span class="o">=</span><span class="mi">1</span>
<span class="n">bar</span><span class="o">=</span><span class="mi">2</span>
</pre></div>
</div>
<p>This will produce a hash variable fact named &#8220;general&#8221; with &#8216;asdf&#8217; and &#8216;bar&#8217; as members.
To validate this, run the following:</p>
<div class="highlight-python"><pre>ansible &lt;hostname&gt; -m setup -a "filter=ansible_local"</pre>
</div>
<p>And you will see the following fact added:</p>
<div class="highlight-python"><pre>"ansible_local": {
        "preferences": {
            "general": {
                "asdf" : "1",
                "bar"  : "2"
            }
        }
 }</pre>
</div>
<p>And this data can be accessed in a template/playbook as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">ansible_local</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">general</span><span class="o">.</span><span class="n">asdf</span> <span class="p">}}</span>
</pre></div>
</div>
<p>The local namespace prevents any user supplied fact from overriding system facts
or variables defined elsewhere in the playbook.</p>
<p>If you have a playbook that is copying over a custom fact and then running it, making an explicit call to re-run the setup module
can allow that fact to be used during that particular play.  Otherwise, it will be available in the next play that gathers fact information.
Here is an example of what that might look like:</p>
<div class="highlight-python"><pre>- hosts: webservers
  tasks:
    - name: create directory for ansible custom facts
      file: state=directory recurse=yes path=/etc/ansible/facts.d
    - name: install custom impi fact
      copy: src=ipmi.fact dest=/etc/ansible/facts.d
    - name: re-read facts after adding custom fact
      setup: filter=ansible_local</pre>
</div>
<p>In this pattern however, you could also write a fact module as well, and may wish to consider this as an option.</p>
</div>
<div class="section" id="registered-variables">
<span id="id8"></span><h2><a class="toc-backref" href="#id31">Registered Variables</a><a class="headerlink" href="#registered-variables" title="Permalink to this headline">¶</a></h2>
<p>Another major use of variables is running a command and using the result of that command to save the result into a variable. Results will vary from module to module. Use of -v when executing playbooks will show possible values for the results.</p>
<p>The value of a task being executed in ansible can be saved in a variable and used later.  See some examples of this in the
<a class="reference internal" href="playbooks_conditionals.html"><em>Conditionals</em></a> chapter.</p>
<p>While it&#8217;s mentioned elsewhere in that document too, here&#8217;s a quick syntax example:</p>
<div class="highlight-python"><pre>- hosts: web_servers

  tasks:

     - shell: /usr/bin/foo
       register: foo_result
       ignore_errors: True

     - shell: /usr/bin/bar
       when: foo_result.rc == 5</pre>
</div>
<p>Registered variables are valid on the host the remainder of the playbook run, which is the same as the lifetime of &#8220;facts&#8221;
in Ansible.  Effectively registered variables are just like facts.</p>
</div>
<div class="section" id="accessing-complex-variable-data">
<span id="id9"></span><h2><a class="toc-backref" href="#id32">Accessing Complex Variable Data</a><a class="headerlink" href="#accessing-complex-variable-data" title="Permalink to this headline">¶</a></h2>
<p>We already talked about facts a little higher up in the documentation.</p>
<p>Some provided facts, like networking information, are made available as nested data structures.  To access
them a simple {{ foo }} is not sufficient, but it is still easy to do.   Here&#8217;s how we get an IP address:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">ansible_eth0</span><span class="p">[</span><span class="s">&quot;ipv4&quot;</span><span class="p">][</span><span class="s">&quot;address&quot;</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
<p>OR alternatively:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">ansible_eth0</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">address</span> <span class="p">}}</span>
</pre></div>
</div>
<p>Similarly, this is how we access the first element of an array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">foo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="magic-variables-and-how-to-access-information-about-other-hosts">
<span id="magic-variables-and-hostvars"></span><h2><a class="toc-backref" href="#id33">Magic Variables, and How To Access Information About Other Hosts</a><a class="headerlink" href="#magic-variables-and-how-to-access-information-about-other-hosts" title="Permalink to this headline">¶</a></h2>
<p>Even if you didn&#8217;t define them yourself, Ansible provides a few variables for you automatically.
The most important of these are &#8216;hostvars&#8217;, &#8216;group_names&#8217;, and &#8216;groups&#8217;.  Users should not use
these names themselves as they are reserved.  &#8216;environment&#8217; is also reserved.</p>
<p>Hostvars lets you ask about the variables of another host, including facts that have been gathered
about that host.  If, at this point, you haven&#8217;t talked to that host yet in any play in the playbook
or set of playbooks, you can get at the variables, but you will not be able to see the facts.</p>
<p>If your database server wants to use the value of a &#8216;fact&#8217; from another node, or an inventory variable
assigned to another node, it&#8217;s easy to do so within a template or even an action line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{{</span> <span class="n">hostvars</span><span class="p">[</span><span class="s">&#39;test.example.com&#39;</span><span class="p">][</span><span class="s">&#39;ansible_distribution&#39;</span><span class="p">]</span> <span class="p">}}</span>
</pre></div>
</div>
<p>Additionally, <em>group_names</em> is a list (array) of all the groups the current host is in.  This can be used in templates using Jinja2 syntax to make template source files that vary based on the group membership (or role) of the host:</p>
<div class="highlight-python"><pre>{% if 'webserver' in group_names %}
   # some part of a configuration file that only applies to webservers
{% endif %}</pre>
</div>
<p><em>groups</em> is a list of all the groups (and hosts) in the inventory.  This can be used to enumerate all hosts within a group.
For example:</p>
<div class="highlight-python"><pre>{% for host in groups['app_servers'] %}
   # something that applies to all app servers.
{% endfor %}</pre>
</div>
<p>A frequently used idiom is walking a group to find all IP addresses in that group:</p>
<div class="highlight-python"><pre>{% for host in groups['app_servers'] %}
   {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}
{% endfor %}</pre>
</div>
<p>An example of this could include pointing a frontend proxy server to all of the app servers, setting up the correct firewall rules between servers, etc.</p>
<p>Additionally, <em>inventory_hostname</em> is the name of the hostname as configured in Ansible&#8217;s inventory host file.  This can
be useful for when you don&#8217;t want to rely on the discovered hostname <cite>ansible_hostname</cite> or for other mysterious
reasons.  If you have a long FQDN, <em>inventory_hostname_short</em> also contains the part up to the first
period, without the rest of the domain.</p>
<p><em>play_hosts</em> is available as a list of hostnames that are in scope for the current play. This may be useful for filling out templates with multiple hostnames or for injecting the list into the rules for a load balancer.</p>
<p>Don&#8217;t worry about any of this unless you think you need it.  You&#8217;ll know when you do.</p>
<p>Also available, <em>inventory_dir</em> is the pathname of the directory holding Ansible&#8217;s inventory host file, <em>inventory_file</em> is the pathname and the filename pointing to the Ansible&#8217;s inventory host file.</p>
</div>
<div class="section" id="variable-file-separation">
<span id="variable-file-seperation-details"></span><h2><a class="toc-backref" href="#id34">Variable File Separation</a><a class="headerlink" href="#variable-file-separation" title="Permalink to this headline">¶</a></h2>
<p>It&#8217;s a great idea to keep your playbooks under source control, but
you may wish to make the playbook source public while keeping certain
important variables private.  Similarly, sometimes you may just
want to keep certain information in different files, away from
the main playbook.</p>
<p>You can do this by using an external variables file, or files, just like this:</p>
<div class="highlight-python"><pre>---

- hosts: all
  remote_user: root
  vars:
    favcolor: blue
  vars_files:
    - /vars/external_vars.yml

  tasks:

  - name: this is just a placeholder
    command: /bin/echo foo</pre>
</div>
<p>This removes the risk of sharing sensitive data with others when
sharing your playbook source with them.</p>
<p>The contents of each variables file is a simple YAML dictionary, like this:</p>
<div class="highlight-python"><pre>---
# in the above example, this would be vars/external_vars.yml
somevar: somevalue
password: magic</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It&#8217;s also possible to keep per-host and per-group variables in very
similar files, this is covered in <a class="reference internal" href="intro_patterns.html"><em>Patterns</em></a>.</p>
</div>
</div>
<div class="section" id="passing-variables-on-the-command-line">
<span id="id10"></span><h2><a class="toc-backref" href="#id35">Passing Variables On The Command Line</a><a class="headerlink" href="#passing-variables-on-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>In addition to <cite>vars_prompt</cite> and <cite>vars_files</cite>, it is possible to send variables over
the Ansible command line.  This is particularly useful when writing a generic release playbook
where you may want to pass in the version of the application to deploy:</p>
<div class="highlight-python"><pre>ansible-playbook release.yml --extra-vars "version=1.23.45 other_variable=foo"</pre>
</div>
<p>This is useful, for, among other things, setting the hosts group or the user for the playbook.</p>
<p>Example:</p>
<div class="highlight-python"><pre>---

- hosts: '{{ hosts }}'
  remote_user: '{{ user }}'

  tasks:
     - ...

ansible-playbook release.yml --extra-vars "hosts=vipers user=starbuck"</pre>
</div>
<p>As of Ansible 1.2, you can also pass in extra vars as quoted JSON, like so:</p>
<div class="highlight-python"><pre>--extra-vars '{"pacman":"mrs","ghosts":["inky","pinky","clyde","sue"]}'</pre>
</div>
<p>The key=value form is obviously simpler, but it&#8217;s there if you need it!</p>
<p>As of Ansible 1.3, extra vars can be loaded from a JSON file with the &#8220;&#64;&#8221; syntax:</p>
<div class="highlight-python"><pre>--extra-vars "@some_file.json"</pre>
</div>
<p>Also as of Ansible 1.3, extra vars can be formatted as YAML, either on the command line
or in a file as above.</p>
</div>
<div class="section" id="conditional-imports">
<span id="id11"></span><h2><a class="toc-backref" href="#id36">Conditional Imports</a><a class="headerlink" href="#conditional-imports" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This behavior is infrequently used in Ansible.  You may wish to skip this section.  The &#8216;group_by&#8217; module as described in the module documentation is a better way to achieve this behavior in most cases.</p>
</div>
<p>Sometimes you will want to do certain things differently in a playbook based on certain criteria.
Having one playbook that works on multiple platforms and OS versions is a good example.</p>
<p>As an example, the name of the Apache package may be different between CentOS and Debian,
but it is easily handled with a minimum of syntax in an Ansible Playbook:</p>
<div class="highlight-python"><pre>---

- hosts: all
  remote_user: root
  vars_files:
    - "vars/common.yml"
    - [ "vars/{{ ansible_os_family }}.yml", "vars/os_defaults.yml" ]

  tasks:

  - name: make sure apache is running
    service: name={{ apache }} state=running</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The variable &#8216;ansible_os_family&#8217; is being interpolated into
the list of filenames being defined for vars_files.</p>
</div>
<p>As a reminder, the various YAML files contain just keys and values:</p>
<div class="highlight-python"><pre>---
# for vars/CentOS.yml
apache: httpd
somethingelse: 42</pre>
</div>
<p>How does this work?  If the operating system was &#8216;CentOS&#8217;, the first file Ansible would try to import
would be &#8216;vars/CentOS.yml&#8217;, followed by &#8216;/vars/os_defaults.yml&#8217; if that file
did not exist.   If no files in the list were found, an error would be raised.
On Debian, it would instead first look towards &#8216;vars/Debian.yml&#8217; instead of &#8216;vars/CentOS.yml&#8217;, before
falling back on &#8216;vars/os_defaults.yml&#8217;. Pretty simple.</p>
<p>To use this conditional import feature, you&#8217;ll need facter or ohai installed prior to running the playbook, but
you can of course push this out with Ansible if you like:</p>
<div class="highlight-python"><pre># for facter
ansible -m yum -a "pkg=facter ensure=installed"
ansible -m yum -a "pkg=ruby-json ensure=installed"

# for ohai
ansible -m yum -a "pkg=ohai ensure=installed"</pre>
</div>
<p>Ansible&#8217;s approach to configuration &#8211; separating variables from tasks, keeps your playbooks
from turning into arbitrary code with ugly nested ifs, conditionals, and so on - and results
in more streamlined &amp; auditable configuration rules &#8211; especially because there are a
minimum of decision points to track.</p>
</div>
<div class="section" id="variable-precedence-where-should-i-put-a-variable">
<span id="variable-precedence"></span><h2><a class="toc-backref" href="#id37">Variable Precedence: Where Should I Put A Variable?</a><a class="headerlink" href="#variable-precedence-where-should-i-put-a-variable" title="Permalink to this headline">¶</a></h2>
<p>A lot of folks may ask about how variables override another.  Ultimately it&#8217;s Ansible&#8217;s philosophy that it&#8217;s better
you know where to put a variable, and then you have to think about it a lot less.</p>
<p>Avoid defining the variable &#8220;x&#8221; in 47 places and then ask the question &#8220;which x gets used&#8221;.
Why?  Because that&#8217;s not Ansible&#8217;s Zen philosophy of doing things.</p>
<p>There is only one Empire State Building. One Mona Lisa, etc.  Figure out where to define a variable, and don&#8217;t make
it complicated.</p>
<p>However, let&#8217;s go ahead and get precedence out of the way!  It exists.  It&#8217;s a real thing, and you might have
a use for it.</p>
<p>If multiple variables of the same name are defined in different places, they win in a certain order, which is:</p>
<div class="highlight-python"><pre>* -e variables always win
* then comes "most everything else"
* then comes variables defined in inventory
* then comes facts discovered about a system
* then "role defaults", which are the most "defaulty" and lose in priority to everything.</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In versions prior to 1.5.4, facts discovered about a system were in the &#8220;most everything else&#8221; category above.</p>
</div>
<p>That seems a little theoretical.  Let&#8217;s show some examples and where you would choose to put what based on the kind of
control you might want over values.</p>
<p>First off, group variables are super powerful.</p>
<p>Site wide defaults should be defined as a &#8216;group_vars/all&#8217; setting.  Group variables are generally placed alongside
your inventory file.  They can also be returned by a dynamic inventory script (see <a class="reference internal" href="intro_dynamic_inventory.html"><em>Dynamic Inventory</em></a>) or defined
in things like <a class="reference internal" href="tower.html"><em>Ansible Tower</em></a> from the UI or API:</p>
<div class="highlight-python"><pre>---
# file: /etc/ansible/group_vars/all
# this is the site wide default
ntp_server: default-time.example.com</pre>
</div>
<p>Regional information might be defined in a &#8216;group_vars/region&#8217; variable.  If this group is a child of the &#8216;all&#8217; group (which it is, because all groups are), it will override the group that is higher up and more general:</p>
<div class="highlight-python"><pre>---
# file: /etc/ansible/group_vars/boston
ntp_server: boston-time.example.com</pre>
</div>
<p>If for some crazy reason we wanted to tell just a specific host to use a specific NTP server, it would then override the group variable!:</p>
<div class="highlight-python"><pre>---
# file: /etc/ansible/host_vars/xyz.boston.example.com
ntp_server: override.example.com</pre>
</div>
<p>So that covers inventory and what you would normally set there.  It&#8217;s a great place for things that deal with geography or behavior.  Since groups are frequently the entity that maps roles onto hosts, it is sometimes a shortcut to set variables on the group instead of defining them on a role.  You could go either way.</p>
<p>Remember:  Child groups override parent groups, and hosts always override their groups.</p>
<p>Next up: learning about role variable precedence.</p>
<p>We&#8217;ll pretty much assume you are using roles at this point.  You should be using roles for sure.  Roles are great.  You are using
roles aren&#8217;t you?  Hint hint.</p>
<p>Ok, so if you are writing a redistributable role with reasonable defaults, put those in the &#8216;roles/x/defaults/main.yml&#8217; file.  This means
the role will bring along a default value but ANYTHING in Ansible will override it.  It&#8217;s just a default.  That&#8217;s why it says &#8220;defaults&#8221; :)
See <a class="reference internal" href="playbooks_roles.html"><em>Playbook Roles and Include Statements</em></a> for more info about this:</p>
<div class="highlight-python"><pre>---
# file: roles/x/defaults/main.yml
# if not overridden in inventory or as a parameter, this is the value that will be used
http_port: 80</pre>
</div>
<p>if you are writing a role and want to ensure the value in the role is absolutely used in that role, and is not going to be overridden
by inventory, you should put it in roles/x/vars/main.yml like so, and inventory values cannot override it.  -e however, still will:</p>
<div class="highlight-python"><pre>---
# file: roles/x/vars/main.yml
# this will absolutely be used in this role
http_port: 80</pre>
</div>
<p>So the above is a great way to plug in constants about the role that are always true.  If you are not sharing your role with others,
app specific behaviors like ports is fine to put in here.  But if you are sharing roles with others, putting variables in here might
be bad. Nobody will be able to override them with inventory, but they still can by passing a parameter to the role.</p>
<p>Parameterized roles are useful.</p>
<p>If you are using a role and want to override a default, pass it as a parameter to the role like so:</p>
<div class="highlight-python"><pre>roles:
   - { name: apache, http_port: 8080 }</pre>
</div>
<p>This makes it clear to the playbook reader that you&#8217;ve made a conscious choice to override some default in the role, or pass in some
configuration that the role can&#8217;t assume by itself.  It also allows you to pass something site-specific that isn&#8217;t really part of the
role you are sharing with others.</p>
<p>This can often be used for things that might apply to some hosts multiple times,
like so:</p>
<div class="highlight-python"><pre>roles:
   - { role: app_user, name: Ian    }
   - { role: app_user, name: Terry  }
   - { role: app_user, name: Graham }
   - { role: app_user, name: John   }</pre>
</div>
<p>That&#8217;s a bit arbitrary, but you can see how the same role was invoked multiple Times.  In that example it&#8217;s quite likely there was
no default for &#8216;name&#8217; supplied at all.  Ansible can yell at you when variables aren&#8217;t defined &#8211; it&#8217;s the default behavior in fact.</p>
<p>So that&#8217;s a bit about roles.</p>
<p>There are a few bonus things that go on with roles.</p>
<p>Generally speaking, variables set in one role are available to others.  This means if you have a &#8220;roles/common/vars/main.yml&#8221; you
can set variables in there and make use of them in other roles and elsewhere in your playbook:</p>
<div class="highlight-python"><pre>roles:
   - { role: common_settings }
   - { role: something, foo: 12 }
   - { role: something_else }</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are some protections in place to avoid the need to namespace variables.
In the above, variables defined in common_settings are most definitely available to &#8216;something&#8217; and &#8216;something_else&#8217; tasks, but if
&#8220;something&#8217;s&#8221; guaranteed to have foo set at 12, even if somewhere deep in common settings it set foo to 20.</p>
</div>
<p>So, that&#8217;s precedence, explained in a more direct way.  Don&#8217;t worry about precedence, just think about if your role is defining a
variable that is a default, or a &#8220;live&#8221; variable you definitely want to use.  Inventory lies in precedence right in the middle, and
if you want to forcibly override something, use -e.</p>
<p>If you found that a little hard to understand, take a look at the <a class="reference external" href="https://github.com/ansible/ansible-examples">ansible-examples</a> repo on our github for a bit more about
how all of these things can work together.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="playbooks.html"><em>Playbooks</em></a></dt>
<dd>An introduction to playbooks</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html"><em>Conditionals</em></a></dt>
<dd>Conditional statements in playbooks</dd>
<dt><a class="reference internal" href="playbooks_loops.html"><em>Loops</em></a></dt>
<dd>Looping in playbooks</dd>
<dt><a class="reference internal" href="playbooks_roles.html"><em>Playbook Roles and Include Statements</em></a></dt>
<dd>Playbook organization by roles</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html"><em>Best Practices</em></a></dt>
<dd>Best practices in playbooks</dd>
<dt><a class="reference external" href="http://groups.google.com/group/ansible-devel">User Mailing List</a></dt>
<dd>Have a question?  Stop by the google group!</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt>
<dd>#ansible IRC chat channel</dd>
</dl>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Variables</a><ul>
<li><a class="reference internal" href="#what-makes-a-valid-variable-name">What Makes A Valid Variable Name</a></li>
<li><a class="reference internal" href="#variables-defined-in-inventory">Variables Defined in Inventory</a></li>
<li><a class="reference internal" href="#variables-defined-in-a-playbook">Variables Defined in a Playbook</a></li>
<li><a class="reference internal" href="#variables-defined-from-included-files-and-roles">Variables defined from included files and roles</a></li>
<li><a class="reference internal" href="#using-variables-about-jinja2">Using Variables: About Jinja2</a></li>
<li><a class="reference internal" href="#jinja2-filters">Jinja2 Filters</a><ul>
<li><a class="reference internal" href="#filters-for-formatting-data">Filters For Formatting Data</a></li>
<li><a class="reference internal" href="#filters-often-used-with-conditionals">Filters Often Used With Conditionals</a></li>
<li><a class="reference internal" href="#forcing-variables-to-be-defined">Forcing Variables To Be Defined</a></li>
<li><a class="reference internal" href="#defaulting-undefined-variables">Defaulting Undefined Variables</a></li>
<li><a class="reference internal" href="#set-theory-filters">Set Theory Filters</a></li>
<li><a class="reference internal" href="#version-comparison-filters">Version Comparison Filters</a></li>
<li><a class="reference internal" href="#random-number-filter">Random Number Filter</a></li>
<li><a class="reference internal" href="#other-useful-filters">Other Useful Filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hey-wait-a-yaml-gotcha">Hey Wait, A YAML Gotcha</a></li>
<li><a class="reference internal" href="#information-discovered-from-systems-facts">Information discovered from systems: Facts</a></li>
<li><a class="reference internal" href="#turning-off-facts">Turning Off Facts</a></li>
<li><a class="reference internal" href="#local-facts-facts-d">Local Facts (Facts.d)</a></li>
<li><a class="reference internal" href="#registered-variables">Registered Variables</a></li>
<li><a class="reference internal" href="#accessing-complex-variable-data">Accessing Complex Variable Data</a></li>
<li><a class="reference internal" href="#magic-variables-and-how-to-access-information-about-other-hosts">Magic Variables, and How To Access Information About Other Hosts</a></li>
<li><a class="reference internal" href="#variable-file-separation">Variable File Separation</a></li>
<li><a class="reference internal" href="#passing-variables-on-the-command-line">Passing Variables On The Command Line</a></li>
<li><a class="reference internal" href="#conditional-imports">Conditional Imports</a></li>
<li><a class="reference internal" href="#variable-precedence-where-should-i-put-a-variable">Variable Precedence: Where Should I Put A Variable?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="playbooks_roles.html"
                        title="previous chapter">Playbook Roles and Include Statements</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="playbooks_conditionals.html"
                        title="next chapter">Conditionals</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="playbooks_conditionals.html" title="Conditionals"
             >next</a> |</li>
        <li class="right" >
          <a href="playbooks_roles.html" title="Playbook Roles and Include Statements"
             >previous</a> |</li>
        <li><a href="index.html">Ansible Documentation</a> &raquo;</li>
          <li><a href="playbooks.html" >Playbooks</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013 Ansible, Inc.
      Last updated on Oct 02, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>